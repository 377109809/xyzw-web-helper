import{k as Ce,c as k,i as m,a as e,J as ge,H as _e,r as V,o as ke,R as xe,p as S,v as ve,f as se,d,l as me,t as _,y as ae,w as v,j as Q,F as pe,g as ye,D as Ie,b as ue,u as ne,K as je,s as qe,G as Ge,P as Ve,x as $e,B as Te,C as Qe,A as Je,S as Ke,U as Ye,e as Xe}from"./index-zSo6r3-J.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as ze}from"./Refresh-BFA_Dvok.js";import{C as We}from"./Copy-e-KYck1l.js";import{C as Re}from"./ChevronDown-BRLSC5Fk.js";import{_ as Ze}from"./xiaoyugan-BojFO6Mw.js";import{S as et}from"./Settings-C9Q-C0tz.js";import{C as tt}from"./CheckmarkCircle-DKXWTr-Z.js";import{B as Pe}from"./index-oBA4xiHu.js";const st={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},at=e("path",{d:"M480 128a64 64 0 0 0-64-64h-16V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 368 48v16H144V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 112 48v16H96a64 64 0 0 0-64 64v12a4 4 0 0 0 4 4h440a4 4 0 0 0 4-4z",fill:"currentColor"},null,-1),nt=e("path",{d:"M32 416a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V179a3 3 0 0 0-3-3H35a3 3 0 0 0-3 3zm344-208a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24z",fill:"currentColor"},null,-1),ot=[at,nt],lt=Ce({name:"Calendar",render:function(s,a){return m(),k("svg",st,ot)}}),it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 328l144-144l144 144"},null,-1),ct=[rt],Ue=Ce({name:"ChevronUp",render:function(s,a){return m(),k("svg",it,ct)}}),ut={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},dt=e("path",{d:"M424.44 227.25a16 16 0 0 1-12.12-12.39c-7.68-36.68-24.45-68.15-49.18-92A153.57 153.57 0 0 0 256 80c-35.5 0-68.24 11.69-94.68 33.8a156.24 156.24 0 0 0-42 56a16 16 0 0 1-11.37 9.15c-27 5.62-51.07 17.34-69.18 33.87C13.39 235.88 0 267.42 0 304c0 36 14.38 68.88 40.49 92.59C65.64 419.43 99.56 432 136 432h260c32.37 0 60.23-8.57 80.59-24.77C499.76 388.78 512 361.39 512 328c0-57.57-42-90.58-87.56-100.75zm-95.2-8.94l-107.8 128a16 16 0 0 1-12 5.69h-.27a16 16 0 0 1-11.88-5.28l-45.9-50.87c-5.77-6.39-5.82-16.33.3-22.4a16 16 0 0 1 23.16.63l33.9 37.58l96-114a16 16 0 1 1 24.48 20.62z",fill:"currentColor"},null,-1),mt=[dt],vt=Ce({name:"CloudDone",render:function(s,a){return m(),k("svg",ut,mt)}}),pt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ft=e("path",{d:"M428 224H288a48 48 0 0 1-48-48V36a4 4 0 0 0-4-4h-92a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h224a64 64 0 0 0 64-64V228a4 4 0 0 0-4-4zm-92 160H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32zm0-80H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),gt=e("path",{d:"M419.22 188.59L275.41 44.78a2 2 0 0 0-3.41 1.41V176a16 16 0 0 0 16 16h129.81a2 2 0 0 0 1.41-3.41z",fill:"currentColor"},null,-1),_t=[ft,gt],Ae=Ce({name:"DocumentText",render:function(s,a){return m(),k("svg",pt,_t)}}),ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},yt=e("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),kt=[yt],bt=Ce({name:"EllipseOutline",render:function(s,a){return m(),k("svg",ht,kt)}}),wt="/xyzw_web_helper/icons/%E7%96%AF%E7%8B%82%E8%B5%9B%E8%BD%A6.png",$t={class:"status-card club-car-king"},Tt={class:"card-header"},Ct={class:"card-content"},St={class:"car-toolbar"},It={key:0,class:"hint"},xt={key:1,class:"hint"},Mt={key:2,class:"car-grid"},Dt={class:"car-header"},zt=["src","alt"],At={class:"car-name"},Nt={class:"car-meta"},Wt={class:"kv"},Rt={class:"v"},Ut={key:0,class:"kv"},Bt={class:"v"},Et={key:1,class:"kv"},Lt={class:"v"},Ht={class:"kv"},Ot={class:"v"},Pt={class:"kv"},Ft={class:"v"},jt={key:2,class:"kv"},qt={class:"car-actions"},Gt={class:"helper-body"},Vt={class:"helper-row"},Be=4*60*60*1e3,Qt={__name:"ClubCarKing",setup(Y){const s=ge(),a=_e(),n=V(!1),l=V(null),h=V(!1),T=V(0),U=V(Date.now());let $=null;ke(()=>{$=setInterval(()=>{U.value=Date.now()},6e4)}),xe(()=>{$&&clearInterval($)});const D=S(()=>new Date(U.value).getHours()>=20),M=S(()=>{const g=new Date(U.value).getDay();return g>=1&&g<=3}),w=S(()=>{const r=s.selectedToken;return r?s.getWebSocketStatus(r.id)==="connected":!1}),Z=r=>{const g=r||{},o=g.body||g,W=o.roleCar||o.rolecar||{},F=W.carDataMap||W.cardatamap;if(F&&typeof F=="object")return Object.entries(F).map(([re,B],ce)=>({key:ce,id:re,...B||{}}));let q=o.cars||o.list||o.data||o.carList||o.vehicles||[];return!Array.isArray(q)&&typeof q=="object"&&q!==null&&(q=Object.values(q)),Array.isArray(o)&&q.length===0&&(q=o),(Array.isArray(q)?q:[]).map((re,B)=>({key:B,...re}))},f=S(()=>Z(l.value)),y=S(()=>(f.value||[]).filter(r=>Number(r.refreshCount??0)===0).length),R=S(()=>y.value>0),O=r=>({1:"绿·普通",2:"蓝·稀有",3:"紫·史诗",4:"橙·传说",5:"红·神话",6:"金·传奇"})[r]||"未知",I=r=>({1:"/icons/大众.svg",2:"/icons/特斯拉.svg",3:"/icons/奥迪.svg",4:"/icons/奔驰.svg",5:"/icons/保时捷.svg",6:"/icons/兰博基尼.svg"})[r]||"/icons/大众.svg",C=r=>{const g=[{type:3,itemId:3201,value:10},{type:3,itemId:1001,value:10},{type:3,itemId:1022,value:2e3},{type:2,itemId:0,value:2e3},{type:3,itemId:1023,value:5},{type:3,itemId:1022,value:2500},{type:3,itemId:1001,value:12}];return Array.isArray(r)?g.some(o=>r.find(W=>W.type===o.type&&W.itemId===o.itemId&&Number(W.value||0)>=o.value)):!1},p=r=>Array.isArray(r)?r.reduce((g,o)=>g+(o.type===3&&o.itemId===35002?Number(o.value||0):0),0):0,b=(r,g)=>{const o=Number((r==null?void 0:r.color)||0),W=Array.isArray(r==null?void 0:r.rewards)?r.rewards:[],F=p(W);return g>=6?o>=5||F>=4||C(W):o>=4||F>=2||C(W)},x=async()=>{var g,o,W;const r=s.selectedToken;if(!r||!w.value){a.warning("请先选择 Token 并建立连接");return}n.value=!0;try{const F=await s.sendMessageWithPromise(r.id,"car_getrolecar",{},1e4);try{const q=await s.sendMessageWithPromise(r.id,"role_getroleinfo",{},1e4),re=(W=(o=(g=q==null?void 0:q.role)==null?void 0:g.items)==null?void 0:o[35002])==null?void 0:W.quantity;T.value=Number(re||0)}catch{}l.value=(F==null?void 0:F.body)??F,h.value=!0,Z(l.value).length?a.success("疯狂赛车数据已更新"):a.info("未识别到车辆字段，已启用智能解析。如仍为空请提供返回示例")}catch(F){a.error("获取车辆数据失败："+(F.message||"未知错误"))}finally{n.value=!1}};ve(w,r=>{r&&!h.value&&x()});const N=async r=>{var o,W,F,q,re;const g=s.selectedToken;if(!g||!w.value){a.warning("请先选择 Token 并建立连接");return}if(!(r!=null&&r.id)){a.warning("未找到车辆ID");return}if(Number(r.sendAt||0)!==0){a.warning("仅未发车的车辆可刷新品阶");return}try{Number(r.refreshCount??0)!==0&&a.info("将消耗车票进行刷新");const B=await s.sendMessageWithPromise(g.id,"car_refresh",{carId:String(r.id)},1e4),ce=(B==null?void 0:B.car)||((o=B==null?void 0:B.body)==null?void 0:o.car)||B;if(ce&&typeof ce=="object"){if(ce.color!=null&&(r.color=Number(ce.color)),ce.refreshCount!=null){r.refreshCount=Number(ce.refreshCount);const De=((W=l.value)==null?void 0:W.body)||l.value||{};De.roleCar&&De.roleCar.refreshCount!=null&&(De.roleCar.refreshCount=Number(ce.refreshCount))}const Se=O(r.color);a.success(`刷新完成：${Se}`)}else await x(),a.success("品阶刷新完成");try{const Se=await s.sendMessageWithPromise(g.id,"role_getroleinfo",{},8e3);T.value=Number(((re=(q=(F=Se==null?void 0:Se.role)==null?void 0:F.items)==null?void 0:q[35002])==null?void 0:re.quantity)||0)}catch{}}catch(B){a.error("刷新失败："+(B.message||"未知错误"))}},L=async r=>{var o;const g=s.selectedToken;if(!g||!w.value){a.warning("请先选择 Token 并建立连接");return}if(Number(r.sendAt||0)!==0){a.info("该车辆已发车");return}if(!M.value){a.warning("非活动时间不可发车（仅周一至周三开放）");return}if(!(r!=null&&r.id)){a.warning("未找到车辆ID");return}if(Number(r.sendAt||0)!==0){a.info("该车辆已发车");return}try{a.info("发车中...");const W=await s.sendMessageWithPromise(g.id,"car_send",{carId:String(r.id),helperId:Number(r.helperId||0),text:"",isUpgrade:!1},1e4),F=(W==null?void 0:W.body)||W,q=(F==null?void 0:F.roleCar)||(F==null?void 0:F.rolecar),re=(q==null?void 0:q.carDataMap)||(q==null?void 0:q.cardatamap);if(re&&re[r.id]){const B=re[r.id],ce=((o=l.value)==null?void 0:o.body)||l.value||{};ce.roleCar&&ce.roleCar.carDataMap&&ce.roleCar.carDataMap[r.id]&&(ce.roleCar.carDataMap[r.id]={...ce.roleCar.carDataMap[r.id],...B}),B.sendAt!=null&&(r.sendAt=B.sendAt),B.color!=null&&(r.color=B.color),B.refreshCount!=null&&(r.refreshCount=B.refreshCount),a.success("已发车")}else await x(),a.success("已发车")}catch(W){a.error("发车失败："+(W.message||"未知错误"))}},H=r=>{const g=Number((r==null?void 0:r.sendAt)||0);if(!g)return!1;const o=g<1e12?g*1e3:g;return U.value-o>=Be},oe=async r=>{var o;const g=s.selectedToken;if(!g||!w.value)return a.warning("请先选择 Token 并建立连接");if(!(r!=null&&r.id))return a.warning("未找到车辆ID");if(!H(r))return a.warning("未到可收车时间（需超过4小时）");try{a.info("收车中...");const W=await s.sendMessageWithPromise(g.id,"car_claim",{carId:String(r.id)},1e4);r.sendAt=0;const F=((o=l.value)==null?void 0:o.body)||l.value||{};F.roleCar&&F.roleCar.carDataMap&&F.roleCar.carDataMap[r.id]&&(F.roleCar.carDataMap[r.id]={...F.roleCar.carDataMap[r.id],sendAt:0}),a.success("收车完成")}catch(W){a.error("收车失败："+(W.message||"未知错误"))}},ie=r=>{const g=Number((r==null?void 0:r.sendAt)||0);return g?(g<1e12?g*1e3:g)+Be-U.value:0},te=r=>{if(r<=0)return"0分";const g=Math.ceil(r/1e3),o=Math.floor(g/3600),W=Math.floor(g%3600/60);return o>0?`${o}小时${W}分`:`${W}分`},j=r=>Number((r==null?void 0:r.sendAt)||0)!==0?H(r)?"收车":`收车(剩余${te(ie(r))})`:"发车",le=r=>Number((r==null?void 0:r.sendAt)||0)!==0?!H(r):D.value||!M.value,J=async r=>{if(!(Number((r==null?void 0:r.sendAt)||0)!==0))return L(r);if(H(r))return oe(r);{const o=te(ie(r));a.info(`未到可收车时间，剩余 ${o}`)}},E=async()=>{if(!s.selectedToken||!w.value)return a.warning("请先选择 Token 并建立连接");try{const g=(f.value||[]).filter(o=>H(o));for(const o of g){try{await oe(o)}catch{}await new Promise(W=>setTimeout(W,300))}await x(),a.success("一键收车完成")}catch(g){a.error("一键收车失败："+(g.message||"未知错误"))}},A=async()=>{if(!s.selectedToken||!w.value)return a.warning("请先选择 Token 并建立连接");try{await x();let g=Number(T.value||0);for(const o of f.value){if(Number(o.sendAt||0)!==0)continue;if(b(o,g)){await L(o),await new Promise(q=>setTimeout(q,500));continue}let W=!1;const F=Number(o.refreshCount??0)===0;if(g>=6)W=!0;else if(F)W=!0;else{await L(o),await new Promise(q=>setTimeout(q,500));continue}for(;W;){if(await N(o),g=Number(T.value||0),b(o,g)){await L(o),await new Promise(re=>setTimeout(re,500));break}const q=Number(o.refreshCount??0)===0;if(g>=6)W=!0;else if(q)W=!0;else{await L(o),await new Promise(re=>setTimeout(re,500));break}}}await x(),a.success("智能发车完成")}catch(g){a.error("智能发车失败："+(g.message||"未知错误"))}},i=V(!1),t=V(!1),c=V([]),u=V(null),P=V(null),K=S(()=>{var r;return((r=s.gameData)==null?void 0:r.legionInfo)||null}),G=S(()=>{var r;return((r=K.value)==null?void 0:r.info)||{}}),ee=S(()=>{var r;return((r=G.value)==null?void 0:r.members)||{}}),z=S(()=>Object.values(ee.value||{})),X=async r=>{var o;const g=s.selectedToken;if(!g||!w.value)return a.warning("请先选择 Token 并建立连接");if(Number(r.color||0)<5)return a.warning("仅品阶≥5的车辆可设置护卫");if(Number(r.sendAt||0)!==0)return a.warning("已发车车辆不可设置护卫");P.value=r,i.value=!0,t.value=!0,u.value=r.helperId?String(r.helperId):null;try{const W=await s.sendMessageWithPromise(g.id,"car_getmemberhelpingcnt",{},1e4),F=((o=W==null?void 0:W.body)==null?void 0:o.memberHelpingCntMap)||(W==null?void 0:W.memberHelpingCntMap)||{},q=z.value.map(re=>{const B=String(re.roleId),ce=Number(F[B]??0);return{label:`${re.name||re.nickname||B}（已护卫 ${ce}/4）`,value:B,disabled:ce>=4}});c.value=q}catch(W){a.error("获取护卫数据失败："+(W.message||"未知错误")),c.value=[]}finally{t.value=!1}},de=()=>{P.value&&(P.value.helperId=u.value?String(u.value):null),i.value=!1},fe=()=>{i.value=!1};return(r,g)=>{const o=se("n-button"),W=se("n-tag"),F=se("n-space"),q=se("n-select"),re=se("n-modal");return m(),k(pe,null,[e("div",$t,[e("div",Tt,[g[3]||(g[3]=e("img",{class:"status-icon",src:wt,alt:"疯狂赛车"},null,-1)),g[4]||(g[4]=e("div",{class:"status-info"},[e("h3",null,"疯狂赛车"),e("p",null,"车辆仓库与品阶")],-1)),e("div",{class:me(["status-badge",{active:f.value.length>0}])},[g[2]||(g[2]=e("div",{class:"status-dot"},null,-1)),e("span",null,_(f.value.length>0?`共 ${f.value.length} 辆`:"暂无数据"),1)],2)]),e("div",Ct,[e("div",St,[d(F,{size:"small"},{default:v(()=>[d(o,{type:"primary",size:"small",loading:n.value,onClick:x},{default:v(()=>[Q(_(n.value?"加载中...":"刷新数据"),1)]),_:1},8,["loading"]),d(o,{size:"small",secondary:"",disabled:n.value||!w.value,onClick:A},{default:v(()=>[...g[5]||(g[5]=[Q("智能发车",-1)])]),_:1},8,["disabled"]),d(o,{size:"small",secondary:"",disabled:n.value||!w.value,onClick:E},{default:v(()=>[...g[6]||(g[6]=[Q("一键收车",-1)])]),_:1},8,["disabled"]),d(W,{size:"small",type:R.value?"success":"default"},{default:v(()=>[Q(_(R.value?`有 ${y.value} 辆可免费刷新`:"无免费刷新"),1)]),_:1},8,["type"]),d(W,{size:"small",type:"info"},{default:v(()=>[Q("剩余车票: "+_(T.value),1)]),_:1})]),_:1})]),w.value?f.value.length===0&&!n.value?(m(),k("div",xt,"暂无车辆数据")):ae("",!0):(m(),k("div",It,"请先选择 Token 并建立连接")),f.value.length>0?(m(),k("div",Mt,[(m(!0),k(pe,null,ye(f.value,B=>(m(),k("div",{key:B.key,class:"car-card"},[e("div",Dt,[e("img",{class:"car-brand-icon",src:I(B.color),alt:O(B.color)},null,8,zt),e("div",{class:me(["car-badge","grade-"+(B.color||0)])},_(O(B.color)),3),e("div",At,_(B.name||B.carName||"车辆 #"+(B.id||B.key)),1)]),e("div",Nt,[e("div",Wt,[g[7]||(g[7]=e("span",{class:"k"},"品阶",-1)),e("span",Rt,[e("span",{class:me(["grade-dot","grade-"+(B.color||0)])},null,2),Q(_(O(B.color)),1)])]),B.level!=null?(m(),k("div",Ut,[g[8]||(g[8]=e("span",{class:"k"},"等级",-1)),e("span",Bt,_(B.level),1)])):ae("",!0),B.star!=null?(m(),k("div",Et,[g[9]||(g[9]=e("span",{class:"k"},"星级",-1)),e("span",Lt,_(B.star),1)])):ae("",!0),e("div",Ht,[g[10]||(g[10]=e("span",{class:"k"},"状态",-1)),e("span",Ot,_(Number(B.sendAt||0)===0?"未发车":"已发车"),1)]),e("div",Pt,[g[11]||(g[11]=e("span",{class:"k"},"帮手",-1)),e("span",Ft,_(Number(B.color||0)>=5?"可携带":"—"),1)]),C(B.rewards)?(m(),k("div",jt,[...g[12]||(g[12]=[e("span",{class:"k"},"奖励",-1),e("span",{class:"v",style:{color:"#f59e0b"}},"包含大奖",-1)])])):ae("",!0)]),e("div",qt,[d(o,{size:"small",type:Number(B.refreshCount??0)===0?"success":"warning",disabled:n.value||Number(B.sendAt||0)!==0,onClick:ce=>N(B)},{default:v(()=>[Q(_(Number(B.refreshCount??0)===0?"免费刷新品阶":"刷新品阶(需车票)"),1)]),_:2},1032,["type","disabled","onClick"]),d(o,{size:"small",type:"primary",disabled:n.value||le(B),onClick:ce=>J(B)},{default:v(()=>[Q(_(j(B)),1)]),_:2},1032,["disabled","onClick"]),d(o,{size:"small",quaternary:"",disabled:n.value||Number(B.color||0)<5||Number(B.sendAt||0)!==0,onClick:ce=>X(B)},{default:v(()=>[...g[13]||(g[13]=[Q(" 护卫 ",-1)])]),_:1},8,["disabled","onClick"])])]))),128))])):ae("",!0)])]),d(re,{show:i.value,"onUpdate:show":g[1]||(g[1]=B=>i.value=B),preset:"card",title:"选择护卫",style:{width:"520px"}},{footer:v(()=>[d(F,null,{default:v(()=>[d(o,{onClick:fe},{default:v(()=>[...g[16]||(g[16]=[Q("取消",-1)])]),_:1}),d(o,{type:"primary",onClick:de},{default:v(()=>[...g[17]||(g[17]=[Q("确定",-1)])]),_:1})]),_:1})]),default:v(()=>[e("div",Gt,[e("div",Vt,[g[14]||(g[14]=e("span",{class:"label"},"护卫成员",-1)),d(q,{value:u.value,"onUpdate:value":g[0]||(g[0]=B=>u.value=B),options:c.value,placeholder:"选择俱乐部成员",loading:t.value,filterable:"",style:{width:"320px"}},null,8,["value","options","loading"])]),g[15]||(g[15]=e("div",{class:"tips"},"说明：次数满 4 的成员不可再被选择。",-1))])]),_:1},8,["show"])],64)}}},Jt=he(Qt,[["__scopeId","data-v-86823775"]]),Kt={class:"status-card"},Yt={class:"card-header"},Xt={class:"status-icon"},Zt={class:"status-title"},es={class:"card-content"},Me=Ce({__name:"MyCard",props:{statusClass:{}},setup(Y){return(s,a)=>(m(),k("div",Kt,[e("div",Yt,[e("div",Xt,[Ie(s.$slots,"icon")]),e("div",Zt,[Ie(s.$slots,"title")]),e("div",{class:me(["status-badge",Y.statusClass])},[a[0]||(a[0]=e("div",{class:"status-dot"},null,-1)),Ie(s.$slots,"badge")],2),Ie(s.$slots,"extra")]),e("div",es,[Ie(s.$slots,"default")]),e("div",{class:me(["card-action",Y.statusClass])},[Ie(s.$slots,"action")],2)]))}}),ts="/xyzw_web_helper/icons/1733492491706152.png";function ss(){const Y=new Date,s=Y.getDay();let a=0;s===6?a=0:s===0?a=1:a=s+1;const n=new Date(Y);n.setDate(Y.getDate()-a);const l=n.getFullYear(),h=String(n.getMonth()+1).padStart(2,"0"),T=String(n.getDate()).padStart(2,"0");return`${l}/${h}/${T}`}function Ee(Y){const s=new Date(Y*1e3),a=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0"),h=String(s.getMinutes()).padStart(2,"0"),T=String(s.getSeconds()).padStart(2,"0");return`${a}-${n} ${l}:${h}:${T}`}function Le(Y){return Y===2?"胜利":"失败"}function He(Y){return Y===0?"进攻":"防守"}function as(Y,s){if(!Y||Y.length===0)return"暂无战绩数据";const a=[`俱乐部盐场战绩 - ${s}`,`参战人数: ${Y.length}`,"─".repeat(40),""],n=[...Y].sort((U,$)=>($.winCnt||0)-(U.winCnt||0));let l=0,h=0,T=0;return n.forEach((U,$)=>{const{name:D,winCnt:M,loseCnt:w,buildingCnt:Z}=U;l+=M||0,h+=w||0,T+=Z||0,a.push(`${$+1}. ${D}  击杀${M||0}  死亡${w||0}  攻城${Z||0}`)}),a.push(""),a.push("─".repeat(40)),a.push(`总计  击杀${l}  死亡${h}  攻城${T}`),a.push(""),a.push(`导出时间: ${new Date().toLocaleString("zh-CN")}`),a.join(`
`)}async function ns(Y){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(Y);else{const s=document.createElement("textarea");s.value=Y,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy")}catch{throw new Error("复制失败")}finally{s.remove()}}}const os={key:0,class:"inline-wrapper"},ls={class:"inline-header"},is={class:"header-actions"},rs={class:"battle-records-content"},cs={key:0,class:"loading-state"},us={key:1,class:"records-list"},ds={class:"records-info"},ms={class:"member-header"},vs={class:"member-info"},ps=["src","alt"],fs={key:1,class:"member-avatar-placeholder"},gs={class:"member-name"},_s={class:"member-stats-inline"},hs={class:"stat-inline win"},ys={class:"stat-inline loss"},ks={class:"stat-inline siege"},bs={class:"battle-details"},ws={key:0,class:"battles-list"},$s={class:"battle-participants"},Ts={class:"participant attacker"},Cs=["src","alt"],Ss={class:"participant-name"},Is={class:"battle-vs"},xs={class:"participant defender"},Ms=["src","alt"],Ds={class:"participant-name"},zs={class:"battle-time"},As={key:1,class:"no-battles"},Ns={key:2,class:"empty-state"},Ws={class:"header-actions"},Rs={class:"battle-records-content"},Us={key:0,class:"loading-state"},Bs={key:1,class:"records-list"},Es={class:"records-info"},Ls={class:"member-header"},Hs={class:"member-info"},Os=["src","alt"],Ps={key:1,class:"member-avatar-placeholder"},Fs={class:"member-name"},js={class:"member-stats-inline"},qs={class:"stat-inline win"},Gs={class:"stat-inline loss"},Vs={class:"stat-inline siege"},Qs={class:"battle-details"},Js={key:0,class:"battles-list"},Ks={class:"battle-participants"},Ys={class:"participant attacker"},Xs=["src","alt"],Zs={class:"participant-name"},ea={class:"battle-vs"},ta={class:"participant defender"},sa=["src","alt"],aa={class:"participant-name"},na={class:"battle-time"},oa={key:1,class:"no-battles"},la={key:2,class:"empty-state"},ia={__name:"ClubBattleRecords",props:{visible:{type:Boolean,default:!1},inline:{type:Boolean,default:!1}},emits:["update:visible"],setup(Y,{expose:s,emit:a}){const n=Y,l=a,h=_e(),T=ge(),U=S({get:()=>n.visible,set:p=>l("update:visible",p)}),$=V(!1),D=V(null),M=V(new Set),w=V("");V({isRegistered:!1});const Z=p=>{const b=[];return p.newWinFlag===2?b.push("battle-win"):b.push("battle-loss"),p.attackType===0?b.push("battle-attack"):b.push("battle-defend"),b.join(" ")},f=p=>{M.value.has(p)?M.value.delete(p):M.value.add(p)},y=p=>{p.target.style.display="none"},R=async()=>{if(!T.selectedToken){h.warning("请先选择游戏角色");return}const p=T.selectedToken.id;if(T.getWebSocketStatus(p)!=="connected"){h.error("WebSocket未连接，无法查询战绩");return}$.value=!0,w.value=ss();try{const x=await T.sendMessageWithPromise(p,"legionwar_getdetails",{date:w.value},1e4);x&&x.roleDetailsList?(D.value=x,h.success("战绩加载成功")):(D.value=null,h.warning("未查询到战绩数据"))}catch(x){console.error("查询战绩失败:",x),h.error(`查询失败: ${x.message}`),D.value=null}finally{$.value=!1}},O=()=>{R()},I=async()=>{if(!D.value||!D.value.roleDetailsList){h.warning("没有可导出的数据");return}try{const p=as(D.value.roleDetailsList,w.value);await ns(p),h.success("战绩已复制到剪贴板")}catch(p){console.error("导出失败:",p),h.error("导出失败，请重试")}},C=()=>{M.value.clear()};return s({fetchBattleRecords:R}),ke(()=>{n.inline&&R()}),(p,b)=>{const x=se("n-icon"),N=se("n-button"),L=se("n-spin"),H=se("n-tag"),oe=se("n-empty"),ie=se("n-collapse-transition"),te=se("n-modal");return m(),k("div",null,[Y.inline?(m(),k("div",os,[e("div",ls,[b[3]||(b[3]=e("div",{class:"inline-title"},"俱乐部盐场战绩",-1)),e("div",is,[d(N,{size:"small",disabled:$.value,onClick:O},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(ze))]),_:1})]),default:v(()=>[b[1]||(b[1]=Q(" 刷新 ",-1))]),_:1},8,["disabled"]),d(N,{type:"primary",size:"small",disabled:!D.value||$.value,onClick:I},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(We))]),_:1})]),default:v(()=>[b[2]||(b[2]=Q(" 导出 ",-1))]),_:1},8,["disabled"])])]),e("div",rs,[$.value?(m(),k("div",cs,[d(L,{size:"large"},{description:v(()=>[...b[4]||(b[4]=[Q("正在加载战绩数据...",-1)])]),_:1})])):D.value&&D.value.roleDetailsList?(m(),k("div",us,[e("div",ds,[d(H,{type:"info"},{default:v(()=>[Q("查询日期: "+_(w.value),1)]),_:1}),d(H,{type:"success"},{default:v(()=>[Q("总成员: "+_(D.value.roleDetailsList.length),1)]),_:1})]),(m(!0),k(pe,null,ye(D.value.roleDetailsList,j=>{var le;return m(),k("div",{key:j.roleId,class:"member-card"},[e("div",ms,[e("div",vs,[j.headImg?(m(),k("img",{key:0,src:j.headImg,alt:j.name,class:"member-avatar",onError:y},null,40,ps)):(m(),k("div",fs,_(((le=j.name)==null?void 0:le.charAt(0))||"?"),1)),e("span",gs,_(j.name),1)]),e("div",_s,[e("span",hs,"击杀 "+_(j.winCnt||0),1),e("span",ys,"死亡 "+_(j.loseCnt||0),1),e("span",ks,"攻城 "+_(j.buildingCnt||0),1)]),d(N,{text:"",size:"small",class:"details-button",onClick:J=>f(j.roleId)},{icon:v(()=>[d(x,null,{default:v(()=>[M.value.has(j.roleId)?(m(),ue(ne(Ue),{key:1})):(m(),ue(ne(Re),{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),d(ie,{show:M.value.has(j.roleId)},{default:v(()=>[e("div",bs,[j.targetRoleList&&j.targetRoleList.length>0?(m(),k("div",ws,[(m(!0),k(pe,null,ye(j.targetRoleList,(J,E)=>{var A,i,t,c;return m(),k("div",{key:E,class:me(["battle-item",Z(J)])},[e("div",$s,[e("div",Ts,[(A=J.roleInfo)!=null&&A.headImg?(m(),k("img",{key:0,src:J.roleInfo.headImg,alt:J.roleInfo.name,class:"participant-avatar",onError:y},null,40,Cs)):ae("",!0),e("span",Ss,_(((i=J.roleInfo)==null?void 0:i.name)||"未知"),1)]),e("div",Is,[d(H,{type:J.attackType===0?"warning":"info",size:"small"},{default:v(()=>[Q(_(ne(He)(J.attackType)),1)]),_:2},1032,["type"]),d(H,{type:J.newWinFlag===2?"success":"error",size:"small"},{default:v(()=>[Q(_(ne(Le)(J.newWinFlag)),1)]),_:2},1032,["type"])]),e("div",xs,[(t=J.targetRoleInfo)!=null&&t.headImg?(m(),k("img",{key:0,src:J.targetRoleInfo.headImg,alt:J.targetRoleInfo.name,class:"participant-avatar",onError:y},null,40,Ms)):ae("",!0),e("span",Ds,_(((c=J.targetRoleInfo)==null?void 0:c.name)||"未知"),1)])]),e("div",zs,_(ne(Ee)(J.timestamp)),1)],2)}),128))])):(m(),k("div",As,[d(oe,{description:"暂无战斗记录",size:"small"})]))])]),_:2},1032,["show"])])}),128))])):(m(),k("div",Ns,[d(oe,{description:"暂无战绩数据",size:"large"},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(Ae))]),_:1})]),_:1})]))])])):(m(),ue(te,{key:1,show:U.value,"onUpdate:show":b[0]||(b[0]=j=>U.value=j),preset:"card",title:"俱乐部盐场战绩",style:{width:"90%","max-width":"800px"},onAfterLeave:C},{"header-extra":v(()=>[e("div",Ws,[d(N,{size:"small",disabled:$.value,onClick:O},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(ze))]),_:1})]),default:v(()=>[b[5]||(b[5]=Q(" 刷新 ",-1))]),_:1},8,["disabled"]),d(N,{type:"primary",size:"small",disabled:!D.value||$.value,onClick:I},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(We))]),_:1})]),default:v(()=>[b[6]||(b[6]=Q(" 导出 ",-1))]),_:1},8,["disabled"])])]),default:v(()=>[e("div",Rs,[$.value?(m(),k("div",Us,[d(L,{size:"large"},{description:v(()=>[...b[7]||(b[7]=[Q("正在加载战绩数据...",-1)])]),_:1})])):D.value&&D.value.roleDetailsList?(m(),k("div",Bs,[e("div",Es,[d(H,{type:"info"},{default:v(()=>[Q("查询日期: "+_(w.value),1)]),_:1}),d(H,{type:"success"},{default:v(()=>[Q("总成员: "+_(D.value.roleDetailsList.length),1)]),_:1})]),(m(!0),k(pe,null,ye(D.value.roleDetailsList,j=>{var le;return m(),k("div",{key:j.roleId,class:"member-card"},[e("div",Ls,[e("div",Hs,[j.headImg?(m(),k("img",{key:0,src:j.headImg,alt:j.name,class:"member-avatar",onError:y},null,40,Os)):(m(),k("div",Ps,_(((le=j.name)==null?void 0:le.charAt(0))||"?"),1)),e("span",Fs,_(j.name),1)]),e("div",js,[e("span",qs,"击杀 "+_(j.winCnt||0),1),e("span",Gs,"死亡 "+_(j.loseCnt||0),1),e("span",Vs,"攻城 "+_(j.buildingCnt||0),1)]),d(N,{text:"",size:"small",class:"details-button",onClick:J=>f(j.roleId)},{icon:v(()=>[d(x,null,{default:v(()=>[M.value.has(j.roleId)?(m(),ue(ne(Ue),{key:1})):(m(),ue(ne(Re),{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),d(ie,{show:M.value.has(j.roleId)},{default:v(()=>[e("div",Qs,[j.targetRoleList&&j.targetRoleList.length>0?(m(),k("div",Js,[(m(!0),k(pe,null,ye(j.targetRoleList,(J,E)=>{var A,i,t,c;return m(),k("div",{key:E,class:me(["battle-item",Z(J)])},[e("div",Ks,[e("div",Ys,[(A=J.roleInfo)!=null&&A.headImg?(m(),k("img",{key:0,src:J.roleInfo.headImg,alt:J.roleInfo.name,class:"participant-avatar",onError:y},null,40,Xs)):ae("",!0),e("span",Zs,_(((i=J.roleInfo)==null?void 0:i.name)||"未知"),1)]),e("div",ea,[d(H,{type:J.attackType===0?"warning":"info",size:"small"},{default:v(()=>[Q(_(ne(He)(J.attackType)),1)]),_:2},1032,["type"]),d(H,{type:J.newWinFlag===2?"success":"error",size:"small"},{default:v(()=>[Q(_(ne(Le)(J.newWinFlag)),1)]),_:2},1032,["type"])]),e("div",ta,[(t=J.targetRoleInfo)!=null&&t.headImg?(m(),k("img",{key:0,src:J.targetRoleInfo.headImg,alt:J.targetRoleInfo.name,class:"participant-avatar",onError:y},null,40,sa)):ae("",!0),e("span",aa,_(((c=J.targetRoleInfo)==null?void 0:c.name)||"未知"),1)])]),e("div",na,_(ne(Ee)(J.timestamp)),1)],2)}),128))])):(m(),k("div",oa,[d(oe,{description:"暂无战斗记录",size:"small"})]))])]),_:2},1032,["show"])])}),128))])):(m(),k("div",la,[d(oe,{description:"暂无战绩数据",size:"large"},{icon:v(()=>[d(x,null,{default:v(()=>[d(ne(Ae))]),_:1})]),_:1})]))])]),_:1},8,["show"]))])}}},ra=he(ia,[["__scopeId","data-v-baffdadd"]]),ca={key:0,class:"empty-club"},ua={class:"actions"},da={key:1},ma={class:"toolbar"},va={class:"overview"},pa={class:"club-header"},fa={class:"meta"},ga={class:"name"},_a={class:"sub"},ha={class:"overview-actions"},ya={class:"grid"},ka={class:"item"},ba={class:"value"},wa={class:"item"},$a={class:"value"},Ta={class:"item"},Ca={class:"value"},Sa={class:"item"},Ia={class:"value"},xa={key:0,class:"announcement"},Ma={class:"text"},Da={key:1,class:"leader"},za={class:"leader-info"},Aa={class:"leader-name"},Na={class:"members"},Wa={class:"members-list"},Ra={class:"left"},Ua={class:"name"},Ba={class:"right"},Ea={class:"power"},La={class:"tag"},Ha={key:0,class:"hint"},Oa={__name:"ClubInfo",setup(Y){const s=ge(),a=_e(),n=S(()=>{var I;return((I=s.gameData)==null?void 0:I.legionInfo)||null}),l=S(()=>{var I;return((I=n.value)==null?void 0:I.info)||null}),h=S(()=>{var I;return((I=l.value)==null?void 0:I.members)||{}}),T=S(()=>Object.values(h.value||{})),U=S(()=>T.value.length),$=S(()=>{var C;const I=(C=l.value)==null?void 0:C.leaderId;return I&&T.value.find(p=>Number(p.roleId)===Number(I))||null}),D=S(()=>[...T.value].sort((I,C)=>{var p,b;return Number(C.power||((p=C.custom)==null?void 0:p.s_power)||0)-Number(I.power||((b=I.custom)==null?void 0:b.s_power)||0)}).slice(0,20)),M=V("overview"),w=S(()=>{var b,x,N,L;const I=Number(((L=(N=(x=(b=s.gameData)==null?void 0:b.roleInfo)==null?void 0:x.role)==null?void 0:N.statisticsTime)==null?void 0:L["legion:sign:in"])||0),C=new Date;C.setHours(0,0,0,0);const p=Math.floor(C.getTime()/1e3);return I>p}),Z=()=>{const I=s.selectedToken;!I||w.value||(s.sendMessage(I.id,"legion_signin"),s.sendMessage(I.id,"role_getroleinfo"),a.info("俱乐部签到"))},f=S(()=>{const I=n.value||{},C=I.info||{},p=I.statistics||I.stat||{},b=Number(C.power??I.power??C.s_power??I.s_power??0),x=C.dan??I.dan??C.rank??I.rank??"-",N=Number(C.redQuenchCnt??I.redQuenchCnt??p["red:quench"]??p.red_quench??0),L=p["last:war:rank"]??p.lastWarRank??p["legion:last:war:rank"]??"-",H=!!(C.noApply??I.noApply);return{power:b,dan:x??"-",redQuench:N,lastWarRank:L,noApply:H}}),y=()=>{const I=s.selectedToken;I&&s.sendMessage(I.id,"legion_getinfo")},R=I=>I===1?"会长":I===2?"副会长":"成员",O=I=>{const C=Number(I||0);return C>=1e8?(C/1e8).toFixed(2)+"亿":C>=1e4?(C/1e4).toFixed(2)+"万":String(C)};return(I,C)=>{const p=se("n-empty"),b=se("n-button"),x=se("n-space"),N=se("n-avatar"),L=se("n-tab-pane"),H=se("n-tabs"),oe=Me;return m(),ue(oe,{class:"club-info",statusClass:{active:!!l.value}},{icon:v(()=>[...C[1]||(C[1]=[e("img",{src:ts,alt:"俱乐部图标"},null,-1)])]),title:v(()=>[...C[2]||(C[2]=[e("h3",null,"俱乐部信息",-1),e("p",null,"军团/俱乐部概览与成员",-1)])]),badge:v(()=>[e("span",null,_(l.value?"已加入":"暂无俱乐部"),1)]),default:v(()=>[l.value?(m(),k("div",da,[e("div",ma,[d(x,{size:"small"},{default:v(()=>[d(b,{size:"small",onClick:y},{default:v(()=>[...C[4]||(C[4]=[Q("刷新",-1)])]),_:1})]),_:1})]),d(H,{value:M.value,"onUpdate:value":C[0]||(C[0]=ie=>M.value=ie),type:"line",animated:""},{default:v(()=>[d(L,{name:"overview",tab:"概览","display-directive":"show:lazy"},{default:v(()=>[e("div",va,[e("div",pa,[d(N,{size:48,src:l.value.logo||"/icons/xiaoyugan.png"},null,8,["src"]),e("div",fa,[e("div",ga,_(l.value.name),1),e("div",_a,"ID "+_(l.value.id)+" · Lv."+_(l.value.level)+" · 服务器 "+_(l.value.serverId),1)])]),e("div",ha,[d(x,{size:"small"},{default:v(()=>[d(b,{size:"small",disabled:w.value,type:"primary",onClick:Z},{default:v(()=>[Q(_(w.value?"已签到":"俱乐部签到"),1)]),_:1},8,["disabled"])]),_:1})]),e("div",ya,[e("div",ka,[C[5]||(C[5]=e("div",{class:"label"},"战力",-1)),e("div",ba,_(O(f.value.power)),1)]),e("div",wa,[C[6]||(C[6]=e("div",{class:"label"},"段位",-1)),e("div",$a,_(f.value.dan),1)]),e("div",Ta,[C[7]||(C[7]=e("div",{class:"label"},"成员数",-1)),e("div",Ca,_(U.value),1)]),e("div",Sa,[C[8]||(C[8]=e("div",{class:"label"},"红洗次数",-1)),e("div",Ia,_(f.value.redQuench),1)])]),l.value.announcement?(m(),k("div",xa,[C[9]||(C[9]=e("div",{class:"label"},"公告",-1)),e("div",Ma,_(l.value.announcement),1)])):ae("",!0),$.value?(m(),k("div",Da,[C[10]||(C[10]=e("div",{class:"label"},"会长",-1)),e("div",za,[d(N,{size:32,src:$.value.headImg||"/icons/xiaoyugan.png"},null,8,["src"]),e("span",Aa,_($.value.name),1)])])):ae("",!0)])]),_:1}),d(L,{name:"members",tab:"成员","display-directive":"show:lazy"},{default:v(()=>[e("div",Na,[e("div",Wa,[(m(!0),k(pe,null,ye(D.value,ie=>{var te;return m(),k("div",{key:ie.roleId,class:"member-row"},[e("div",Ra,[d(N,{size:28,src:ie.headImg||"/icons/xiaoyugan.png"},null,8,["src"]),e("span",Ua,_(ie.name),1)]),e("div",Ba,[e("span",Ea,_(O(ie.power||((te=ie.custom)==null?void 0:te.s_power)||0)),1),e("span",La,_(R(ie.job)),1)])])}),128))]),U.value>D.value.length?(m(),k("div",Ha,"仅显示前 "+_(D.value.length)+" 名(按战力)",1)):ae("",!0)])]),_:1}),d(L,{name:"records",tab:"盐场战绩","display-directive":"show:lazy"},{default:v(()=>[d(ra,{inline:""})]),_:1})]),_:1},8,["value"])])):(m(),k("div",ca,[d(p,{description:"暂无俱乐部"}),e("div",ua,[d(b,{size:"small",onClick:y},{default:v(()=>[...C[3]||(C[3]=[Q("刷新",-1)])]),_:1})])]))]),_:1},8,["statusClass"])}}},Pa=he(Oa,[["__scopeId","data-v-4cb31180"]]),Fa="/xyzw_web_helper/icons/1733492491706148.png",ja={class:"status-card tower-status"},qa={class:"card-header"},Ga={class:"energy-display"},Va={class:"energy-count"},Qa={class:"card-content"},Ja={class:"tower-floor"},Ka={class:"floor-number"},Ya={class:"card-actions"},Xa=["disabled"],Za={__name:"TowerStatus",setup(Y){const s=ge(),a=_e(),n=V(!1),l=V(null);V(null);const h=S(()=>{var y;return((y=s.gameData)==null?void 0:y.roleInfo)||null}),T=S(()=>{var I,C;const f=(C=(I=h.value)==null?void 0:I.role)==null?void 0:C.tower;if(!f||!f.id&&f.id!==0)return"0 - 0";const y=f.id,R=Math.floor(y/10)+1,O=y%10+1;return`${R} - ${O}`}),U=S(()=>{var R,O;const f=(O=(R=h.value)==null?void 0:R.role)==null?void 0:O.tower;return(f==null?void 0:f.energy)||0}),$=S(()=>{const f=U.value>0,y=!n.value;return f&&y}),D=async()=>{if(!s.selectedToken){a.warning("请先选择Token");return}if(!$.value){a.warning("体力不足或正在爬塔中");return}l.value&&(clearTimeout(l.value),l.value=null),n.value=!0,l.value=setTimeout(()=>{n.value=!1,l.value=null},15e3);try{const f=s.selectedToken.id;await s.sendMessageWithPromise(f,"fight_starttower",{},1e4),a.success("爬塔命令已发送"),await w(),setTimeout(async()=>{await w(),l.value&&(clearTimeout(l.value),l.value=null),n.value=!1},2e3)}catch(f){a.error("爬塔失败: "+(f.message||"未知错误")),l.value&&(clearTimeout(l.value),l.value=null),n.value=!1}},M=()=>{l.value&&(clearTimeout(l.value),l.value=null),n.value=!1,a.info("爬塔状态已重置")},w=async()=>{if(s.selectedToken)try{const f=s.selectedToken.id;if(s.getWebSocketStatus(f)!=="connected")return;const R=s.sendMessage(f,"role_getroleinfo"),O=s.sendMessage(f,"tower_getinfo")}catch{}},Z=S(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected");return ve(Z,(f,y)=>{f==="connected"&&y!=="connected"&&setTimeout(()=>{w()},1e3)}),ve(()=>s.selectedToken,(f,y)=>{f&&f.id!==(y==null?void 0:y.id)&&s.getWebSocketStatus(f.id)==="connected"&&w()}),ve(()=>s.gameData.towerResult,(f,y)=>{f&&f.timestamp!==(y==null?void 0:y.timestamp)&&(f.success?(a.success("咸将塔挑战成功！"),f.autoReward&&setTimeout(()=>{a.success(`自动领取第${f.rewardFloor}层奖励`)},1e3)):a.error("咸将塔挑战失败"),setTimeout(()=>{l.value&&(clearTimeout(l.value),l.value=null),n.value=!1},2e3))},{deep:!0}),ke(()=>{s.selectedToken&&s.getWebSocketClient(s.selectedToken.id),s.selectedToken&&Z.value==="connected"&&w()}),(f,y)=>(m(),k("div",ja,[e("div",qa,[y[1]||(y[1]=e("img",{src:Fa,alt:"爬塔图标",class:"status-icon"},null,-1)),y[2]||(y[2]=e("div",{class:"status-info"},[e("h3",null,"咸将塔"),e("p",null,"一个不小心就过了")],-1)),e("div",Ga,[y[0]||(y[0]=e("img",{src:Ze,alt:"小鱼干",class:"energy-icon"},null,-1)),e("span",Va,_(U.value),1)])]),e("div",Qa,[e("div",Ja,[y[3]||(y[3]=e("span",{class:"label"},"当前层数",-1)),e("span",Ka,_(T.value),1)])]),e("div",Ya,[e("button",{class:me(["climb-button",{active:$.value,disabled:!$.value}]),disabled:!$.value,onClick:D},_(n.value.value?"爬塔中...":"开始爬塔"),11,Xa),n.value.value?(m(),k("button",{key:0,class:"reset-button",onClick:M}," 重置状态 ")):ae("",!0)])]))}},en=he(Za,[["__scopeId","data-v-1b77bcb2"]]),tn="/xyzw_web_helper/icons/174023274867420.png",sn={class:"status-card daily-task"},an={class:"card-header"},nn={class:"header-right"},on={class:"card-content"},ln={class:"progress-container"},rn={class:"card-actions"},cn=["disabled"],un={key:0,class:"loading-text"},dn={key:1},mn={key:2},vn={class:"modal-header"},pn={class:"settings-content"},fn={class:"settings-grid"},gn={class:"setting-item"},_n={class:"setting-item"},hn={class:"setting-item"},yn={class:"setting-switches"},kn={class:"switch-row"},bn={class:"switch-row"},wn={class:"switch-row"},$n={class:"switch-row"},Tn={class:"switch-row"},Cn={class:"switch-row"},Sn={class:"switch-row"},In={class:"modal-header"},xn=["disabled"],Mn={class:"task-list"},Dn={class:"task-item-left"},zn={class:"task-name"},An={class:"modal-header"},Nn={class:"log-time"},Oe=500,Wn={__name:"DailyTaskStatus",setup(Y){const s=ge(),a=_e(),n=V(!1),l=V(!1),h=V(!1),T=V(!1),U=V(null),$=je({arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),D=V([{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品（请设置采购清单）",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}]),M=[1,2,3,4].map(i=>({label:`阵容${i}`,value:i})),w=[0,1,2,3,4].map(i=>({label:`${i}次`,value:i})),Z=S(()=>s.selectedTokenRoleInfo),f=S(()=>{var i,t,c;return((c=(t=(i=Z.value)==null?void 0:i.role)==null?void 0:t.dailyTask)==null?void 0:c.dailyPoint)??0}),y=S(()=>Math.min(f.value,100)),R=S(()=>y.value>=100),O=S(()=>R.value?"#10b981":"#3b82f6"),I=S(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id)==="connected":!1),C=V([]),p=(i,t="info")=>{const c=new Date().toLocaleTimeString();C.value.push({time:c,message:i,type:t}),C.value.length>Oe&&C.value.splice(0,C.value.length-Oe),Ge(()=>{U.value&&(U.value.scrollTop=U.value.scrollHeight)})},b=i=>{var K,G;if(!((G=(K=i==null?void 0:i.role)==null?void 0:K.dailyTask)!=null&&G.complete)){p("角色信息中无任务完成数据","warning");return}const t=i.role.dailyTask.complete,c=ee=>ee===-1;p("开始同步任务完成状态..."),p(`服务器返回的任务完成数据: ${JSON.stringify(t)}`);let u=0,P=0;D.value.forEach(ee=>{ee.completed=!1}),Object.keys(t).forEach(ee=>{const z=Number(ee),X=D.value.findIndex(de=>de.id===z);if(X>=0){const de=c(t[ee]);D.value[X].completed=de,u++,de&&P++,p(`任务${z} "${D.value[X].name}": ${de?"已完成":"未完成"}`,de?"success":"info")}else p(`服务器返回未知任务ID: ${z} (完成值: ${t[ee]})`,"warning")}),p(`任务状态同步完成: ${P}/${u} 已完成`),p(`当前进度: ${f.value}/100`)},x=async()=>{if(!s.selectedToken)throw new Error("没有选中的Token");const i=s.selectedToken.id;p("正在获取角色信息...");try{const t=await s.sendGetRoleInfo(i);return p("角色信息获取成功","success"),t&&b(t),t}catch(t){throw p(`获取角色信息失败: ${t.message}`,"error"),t}},N=async(i,t,c={},u="",P=8e3)=>{try{u&&p(`执行: ${u}`);const K=await s.sendMessageWithPromise(i,t,c,P);return await new Promise(G=>setTimeout(G,500)),u&&p(`${u} - 成功`,"success"),K}catch(K){throw u&&p(`${u} - 失败: ${K.message}`,"error"),K}},L=i=>{var c,u,P,K,G;const t=((c=i==null?void 0:i.rankList)==null?void 0:c[0])||((u=i==null?void 0:i.roleList)==null?void 0:u[0])||((P=i==null?void 0:i.targets)==null?void 0:P[0])||((K=i==null?void 0:i.targetList)==null?void 0:K[0])||((G=i==null?void 0:i.list)==null?void 0:G[0]);return t!=null&&t.roleId?t.roleId:t!=null&&t.id?t.id:(i==null?void 0:i.roleId)||(i==null?void 0:i.id)},H=i=>{if(!i)return!0;const t=new Date().toDateString(),c=new Date(i).toDateString();return t!==c},oe=()=>{const i=[9904,9905,9901,9902,9903,9904,9905],t=new Date().getDay();return i[t]},ie=async(i,t,c,u)=>{var P,K,G;try{const ee=(K=(P=s.gameData)==null?void 0:P.presetTeam)==null?void 0:K.presetTeamInfo;let z=ee==null?void 0:ee.useTeamId;if(z)u(`从缓存获取当前阵容: ${z}`);else{u("缓存中无阵容信息，从服务器获取...");const X=await N(i,"presetteam_getinfo",{},"获取阵容信息");z=(G=X==null?void 0:X.presetTeamInfo)==null?void 0:G.useTeamId,u(`从服务器获取当前阵容: ${z}`)}return z===t?(u(`当前已是${c}${t}，无需切换`,"success"),!1):(u(`当前阵容: ${z}, 目标阵容: ${t}，开始切换...`),await N(i,"presetteam_saveteam",{teamId:t},`切换到${c}${t}`),u(`成功切换到${c}${t}`,"success"),!0)}catch(ee){u(`阵容检查失败，直接切换: ${ee.message}`,"warning");try{return await N(i,"presetteam_saveteam",{teamId:t},`强制切换到${c}${t}`),!0}catch(z){throw u(`强制切换也失败: ${z.message}`,"error"),z}}},te=async(i,t,c)=>{var g;const u=s.selectedToken.id,P=i==null?void 0:i.role;if(!P)throw new Error("角色数据不存在");t("开始执行每日任务补差");const K=((g=P.dailyTask)==null?void 0:g.complete)??{},G=o=>K[o]===-1,ee=P.statistics??{},z=P.statisticsTime??{},X=[];if(G(2)||X.push({name:"分享一次游戏",execute:()=>N(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),G(3)||X.push({name:"赠送好友金币",execute:()=>N(u,"friend_batch",{},"赠送好友金币")}),G(4)||(X.push({name:"免费招募",execute:()=>N(u,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),$.payRecruit&&X.push({name:"付费招募",execute:()=>N(u,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!G(6)&&H(z["buy:gold"]))for(let o=0;o<3;o++)X.push({name:`免费点金 ${o+1}/3`,execute:()=>N(u,"system_buygold",{buyNum:1},`免费点金 ${o+1}`)});if(!G(5)&&$.claimHangUp){for(let o=0;o<4;o++)X.push({name:`挂机加钟 ${o+1}/4`,execute:()=>N(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${o+1}`)});X.push({name:"领取挂机奖励",execute:()=>N(u,"system_claimhangupreward",{},"领取挂机奖励")}),X.push({name:"挂机加钟 5/5",execute:()=>N(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(!G(7)&&$.openBox&&X.push({name:"开启木质宝箱",execute:()=>N(u,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),!G(14)&&$.claimBottle&&X.push({name:"领取盐罐奖励",execute:()=>N(u,"bottlehelper_claim",{},"领取盐罐奖励")}),!G(13)&&$.arenaEnable&&X.push({name:"竞技场战斗",execute:async()=>{if(t("开始竞技场战斗流程"),new Date().getHours()<8){t("当前时间未到8点，跳过竞技场战斗","warning");return}if(new Date().getHours()>22){t("当前时间已过22点，跳过竞技场战斗","warning");return}await ie(u,$.arenaFormation,"竞技场阵容",t),await N(u,"arena_startarea",{},"开始竞技场");for(let o=1;o<=3;o++){t(`竞技场战斗 ${o}/3`);let W;try{W=await N(u,"arena_getareatarget",{},`获取竞技场目标${o}`)}catch(q){t(`竞技场战斗${o} - 获取对手失败: ${q.message}`,"error");break}const F=L(W);F?await N(u,"fight_startareaarena",{targetId:F},`竞技场战斗${o}`,1e4):t(`竞技场战斗${o} - 未找到目标`,"warning"),await new Promise(q=>setTimeout(q,1e3))}}}),$.bossTimes>0){const o=ee["legion:boss"]??0,W=Math.max($.bossTimes-o,0);if(W>0){X.push({name:"军团BOSS阵容检查",execute:()=>ie(u,$.bossFormation,"BOSS阵容",t)});for(let q=0;q<W;q++)X.push({name:`军团BOSS ${q+1}/${W}`,execute:()=>N(u,"fight_startlegionboss",{},`军团BOSS ${q+1}`,12e3)})}const F=oe();W===0&&X.push({name:"每日BOSS阵容检查",execute:()=>ie(u,$.bossFormation,"BOSS阵容",t)});for(let q=0;q<3;q++)X.push({name:`每日BOSS ${q+1}/3`,execute:()=>N(u,"fight_startboss",{bossId:F},`每日BOSS ${q+1}`,12e3)})}const de=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取每日免费奖励",cmd:"collection_claimfreereward"},{name:"领取免费礼包",cmd:"card_claimreward"},{name:"领取永久卡礼包",cmd:"card_claimreward",params:{cardId:4003}}];if($.claimEmail&&de.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),de.forEach(o=>{X.push({name:o.name,execute:()=>N(u,o.cmd,o.params||{},o.name)})}),H(z["artifact:normal:lottery:time"]))for(let o=0;o<3;o++)X.push({name:`免费钓鱼 ${o+1}/3`,execute:()=>N(u,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${o+1}`)});const fe=["魏国","蜀国","吴国","群雄"];for(let o=1;o<=4;o++)H(z[`genie:daily:free:${o}`])&&X.push({name:`${fe[o-1]}灯神免费扫荡`,execute:()=>N(u,"genie_sweep",{genieId:o},`${fe[o-1]}灯神免费扫荡`)});for(let o=0;o<3;o++)X.push({name:`领取免费扫荡卷 ${o+1}/3`,execute:()=>N(u,"genie_buysweep",{},`领取免费扫荡卷 ${o+1}`)});!G(12)&&$.blackMarketPurchase&&X.push({name:"黑市购买1次物品",execute:()=>N(u,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let o=1;o<=10;o++)X.push({name:`领取任务奖励${o}`,execute:()=>N(u,"task_claimdailypoint",{taskId:o},`领取任务奖励${o}`,5e3)});X.push({name:"领取日常任务奖励",execute:()=>N(u,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>N(u,"task_claimweekreward",{},"领取周常任务奖励")});const r=X.length;t(`共有 ${r} 个任务待执行`);for(let o=0;o<X.length;o++){const W=X[o];try{await W.execute();const F=Math.floor((o+1)/r*100);c&&c(u,F),await new Promise(q=>setTimeout(q,500))}catch(F){t(`任务执行失败: ${W.name} - ${F.message}`,"error")}}c&&c(u,100),t("所有任务执行完成","success"),await new Promise(o=>setTimeout(o,2e3)),await x()},j=async()=>{var i;if(!s.selectedToken||T.value){a.warning("没有选中Token或正在执行中");return}if(!I.value){a.error("WebSocket连接未建立，请检查连接状态");return}T.value=!0,h.value=!0,C.value=[];try{p("=== 开始执行一键补差任务 ===");const t=await x();if(!(t!=null&&t.role))throw new Error("获取角色信息失败或数据异常");p(`当前每日任务进度: ${((i=t.role.dailyTask)==null?void 0:i.dailyPoint)||0}/100`),p("第二步: 开始执行每日任务..."),await te(t,p,(c,u)=>{p(`任务进度: ${u}%`)}),p("=== 任务执行完成 ===","success"),a.success("每日任务补差执行完成"),setTimeout(async()=>{try{await x(),p("最终角色信息刷新完成","success")}catch(c){p(`最终刷新失败: ${c.message}`,"warning")}},3e3)}catch(t){p(`任务执行失败: ${t.message}`,"error"),console.error("详细错误信息:",t),a.error(`任务执行失败: ${t.message}`)}finally{T.value=!1}},le=async()=>{if(!I.value){a.warning("WebSocket未连接，无法刷新任务状态");return}try{p("手动刷新任务状态..."),await x(),a.success("任务状态刷新成功")}catch(i){p(`刷新失败: ${i.message}`,"error"),a.error(`刷新失败: ${i.message}`)}},J=()=>s.selectedToken?{roleId:s.selectedToken.id}:null,E=i=>{try{const t=localStorage.getItem(`daily-settings:${i}`);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load settings:",t),null}},A=(i,t)=>{try{localStorage.setItem(`daily-settings:${i}`,JSON.stringify(t))}catch(c){console.error("Failed to save settings:",c)}};return ve($,i=>{const t=J();t&&A(t.roleId,i)},{deep:!0}),ve(()=>s.selectedToken,async(i,t)=>{if(i&&i!==t){p(`切换到Token: ${i.name}`);const c=E(i.id);if(c&&Object.assign($,c),I.value)try{await x()}catch(u){console.warn("切换token后获取角色信息失败:",u.message)}}},{immediate:!0}),ve(()=>s.selectedTokenRoleInfo,i=>{var t,c;(c=(t=i==null?void 0:i.role)==null?void 0:t.dailyTask)!=null&&c.complete&&(p("角色信息更新，同步任务状态"),b(i))},{immediate:!0,deep:!0}),ke(async()=>{if(p("组件初始化完成"),s.selectedToken&&I.value)try{await x()}catch(t){console.warn("初始化时获取角色信息失败:",t.message)}const i=J();if(i){const t=E(i.roleId);t&&Object.assign($,t)}}),qe(()=>{p("组件即将卸载")}),(i,t)=>{const c=se("n-progress"),u=se("n-icon"),P=se("n-select"),K=se("n-switch"),G=se("n-modal"),ee=se("n-tag");return m(),k("div",sn,[e("div",an,[t[17]||(t[17]=e("img",{src:tn,alt:"每日任务",class:"status-icon"},null,-1)),t[18]||(t[18]=e("div",{class:"status-info"},[e("h3",null,"每日任务"),e("p",null,"当前进度")],-1)),e("div",nn,[e("div",{class:me(["status-badge",{completed:R.value}]),onClick:t[0]||(t[0]=z=>l.value=!0)},[e("div",{class:me(["status-dot",{completed:R.value}])},null,2),t[15]||(t[15]=e("span",null,"任务详情",-1))],2),e("button",{class:"settings-gear",onClick:t[1]||(t[1]=z=>n.value=!0),title:"任务设置"},[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.240.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])])]),e("div",on,[e("div",ln,[d(c,{type:"line",percentage:y.value,height:8,"border-radius":4,color:O.value,"rail-color":"#f3f4f6"},null,8,["percentage","color"])]),t[19]||(t[19]=e("div",{class:"info-container"}," 右上角小齿轮有惊喜 ",-1))]),e("div",rn,[e("button",{class:"action-button",disabled:T.value||!I.value,onClick:j},[T.value?(m(),k("span",un,[...t[20]||(t[20]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),Q(" 执行中... ",-1)])])):I.value?(m(),k("span",mn,"一键补差")):(m(),k("span",dn,"WebSocket未连接"))],8,cn)]),d(G,{show:n.value,"onUpdate:show":t[12]||(t[12]=z=>n.value=z),preset:"card",title:"任务设置",style:{width:"400px"}},{header:v(()=>[e("div",vn,[d(u,null,{default:v(()=>[d(ne(et))]),_:1}),t[21]||(t[21]=e("span",null,"任务设置",-1))])]),default:v(()=>[e("div",pn,[e("div",fn,[e("div",gn,[t[22]||(t[22]=e("label",{class:"setting-label"},"竞技场阵容",-1)),d(P,{value:$.arenaFormation,"onUpdate:value":t[2]||(t[2]=z=>$.arenaFormation=z),options:ne(M),size:"small"},null,8,["value","options"])]),e("div",_n,[t[23]||(t[23]=e("label",{class:"setting-label"},"BOSS阵容",-1)),d(P,{value:$.bossFormation,"onUpdate:value":t[3]||(t[3]=z=>$.bossFormation=z),options:ne(M),size:"small"},null,8,["value","options"])]),e("div",hn,[t[24]||(t[24]=e("label",{class:"setting-label"},"BOSS次数",-1)),d(P,{value:$.bossTimes,"onUpdate:value":t[4]||(t[4]=z=>$.bossTimes=z),options:ne(w),size:"small"},null,8,["value","options"])]),e("div",yn,[e("div",kn,[t[25]||(t[25]=e("span",{class:"switch-label"},"领罐子",-1)),d(K,{value:$.claimBottle,"onUpdate:value":t[5]||(t[5]=z=>$.claimBottle=z)},null,8,["value"])]),e("div",bn,[t[26]||(t[26]=e("span",{class:"switch-label"},"领挂机",-1)),d(K,{value:$.claimHangUp,"onUpdate:value":t[6]||(t[6]=z=>$.claimHangUp=z)},null,8,["value"])]),e("div",wn,[t[27]||(t[27]=e("span",{class:"switch-label"},"竞技场",-1)),d(K,{value:$.arenaEnable,"onUpdate:value":t[7]||(t[7]=z=>$.arenaEnable=z)},null,8,["value"])]),e("div",$n,[t[28]||(t[28]=e("span",{class:"switch-label"},"开宝箱",-1)),d(K,{value:$.openBox,"onUpdate:value":t[8]||(t[8]=z=>$.openBox=z)},null,8,["value"])]),e("div",Tn,[t[29]||(t[29]=e("span",{class:"switch-label"},"领取邮件奖励",-1)),d(K,{value:$.claimEmail,"onUpdate:value":t[9]||(t[9]=z=>$.claimEmail=z)},null,8,["value"])]),e("div",Cn,[t[30]||(t[30]=e("span",{class:"switch-label"},"黑市购买物品",-1)),d(K,{value:$.blackMarketPurchase,"onUpdate:value":t[10]||(t[10]=z=>$.blackMarketPurchase=z)},null,8,["value"])]),e("div",Sn,[t[31]||(t[31]=e("span",{class:"switch-label"},"付费招募",-1)),d(K,{value:$.payRecruit,"onUpdate:value":t[11]||(t[11]=z=>$.payRecruit=z)},null,8,["value"])])])])])]),_:1},8,["show"]),d(G,{show:l.value,"onUpdate:show":t[13]||(t[13]=z=>l.value=z),preset:"card",title:"每日任务详情",style:{width:"400px"}},{header:v(()=>[e("div",In,[d(u,null,{default:v(()=>[d(ne(lt))]),_:1}),t[33]||(t[33]=e("span",null,"每日任务详情",-1)),e("button",{class:"refresh-button",disabled:T.value,onClick:le},[d(u,null,{default:v(()=>[d(ne(ze))]),_:1}),t[32]||(t[32]=Q(" 刷新状态 ",-1))],8,xn)])]),default:v(()=>[e("div",Mn,[(m(!0),k(pe,null,ye(D.value,z=>(m(),k("div",{key:z.id,class:"task-item"},[e("div",Dn,[d(u,{class:me(["task-status-icon",{completed:z.completed}])},{default:v(()=>[z.completed?(m(),ue(ne(tt),{key:0})):(m(),ue(ne(bt),{key:1}))]),_:2},1032,["class"]),e("span",zn,_(z.name),1)]),d(ee,{type:z.completed?"success":"default",size:"small"},{default:v(()=>[Q(_(z.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]),_:1},8,["show"]),d(G,{show:h.value,"onUpdate:show":t[14]||(t[14]=z=>h.value=z),preset:"card",title:"任务执行日志",style:{width:"500px"}},{header:v(()=>[e("div",An,[d(u,null,{default:v(()=>[d(ne(Ae))]),_:1}),t[34]||(t[34]=e("span",null,"任务执行日志",-1))])]),default:v(()=>[e("div",{ref_key:"logContainer",ref:U,class:"log-container"},[(m(!0),k(pe,null,ye(C.value,z=>(m(),k("div",{key:z.time+z.message,class:"log-item"},[e("span",Nn,_(z.time),1),e("span",{class:me(["log-message",{error:z.type==="error",success:z.type==="success",warning:z.type==="warning"}])},_(z.message),3)]))),128))],512)]),_:1},8,["show"])])}}},Rn=he(Wn,[["__scopeId","data-v-efa46ae1"]]),Ne="/xyzw_web_helper/icons/Ob7pyorzmHiJcbab2c25af264d0758b527bc1b61cc3b.png",Un={class:"status-card team-formation-card"},Bn={class:"card-header"},En={class:"team-selector"},Ln=["disabled","onClick"],Hn=["disabled"],On={class:"card-content"},Pn={class:"current-team-info"},Fn={class:"team-number"},jn={class:"heroes-container"},qn={key:0,class:"heroes-inline"},Gn={class:"hero-circle"},Vn=["src","alt"],Qn={key:1,class:"hero-placeholder"},Jn={class:"hero-name"},Kn={key:1,class:"empty-team"},Yn={key:2,class:"empty-team"},Xn=Ce({__name:"TeamFormation",setup(Y){const s=ge(),a=_e(),n=V(!1),l=V(!1),h=V(1),T=V([1,2,3,4]),U={101:{name:"司马懿",type:"魏国",avatar:"/team/simayi.png"},102:{name:"郭嘉",type:"魏国",avatar:"/team/guojia.png"},103:{name:"关羽",type:"蜀国",avatar:"/team/guanyu.png"},104:{name:"诸葛亮",type:"蜀国",avatar:"/team/zhugeliang.png"},105:{name:"周瑜",type:"吴国",avatar:"/team/zhouyu.png"},106:{name:"太史慈",type:"吴国",avatar:"/team/taishici.png"},107:{name:"吕布",type:"群雄",avatar:"/team/lvbu.png"},108:{name:"华佗",type:"群雄",avatar:"/team/huatuo.png"},109:{name:"甄姬",type:"魏国",avatar:"/team/zhenji.png"},110:{name:"黄月英",type:"蜀国",avatar:"/team/huangyueying.png"},111:{name:"孙策",type:"吴国",avatar:"/team/sunce.png"},112:{name:"贾诩",type:"群雄",avatar:"/team/jiaxu.png"},113:{name:"曹仁",type:"魏国",avatar:"/team/caoren.png"},114:{name:"姜维",type:"蜀国",avatar:"/team/jiangwei.png"},115:{name:"孙坚",type:"吴国",avatar:"/team/sunjian.png"},116:{name:"公孙瓒",type:"群雄",avatar:"/team/gongsunzan.png"},117:{name:"典韦",type:"魏国",avatar:"/team/dianwei.png"},118:{name:"赵云",type:"蜀国",avatar:"/team/zhaoyun.png"},119:{name:"大乔",type:"吴国",avatar:"/team/daqiao.png"},120:{name:"张角",type:"群雄",avatar:"/team/zhangjiao.png"},201:{name:"徐晃",type:"魏国",avatar:"/team/xuhuang.png"},202:{name:"荀彧",type:"魏国",avatar:"/team/xunyu.png"},203:{name:"典韦",type:"魏国",avatar:"/team/xiaodianwei.png"},204:{name:"张飞",type:"蜀国",avatar:"/team/zhangfei.png"},205:{name:"赵云",type:"蜀国",avatar:"/team/xiaozhaoyun.png"},206:{name:"庞统",type:"蜀国",avatar:"/team/pangtong.png"},207:{name:"鲁肃",type:"吴国",avatar:"/team/lusu.png"},208:{name:"陆逊",type:"吴国",avatar:"/team/luxun.png"},209:{name:"甘宁",type:"吴国",avatar:"/team/ganning.png"},210:{name:"貂蝉",type:"群雄",avatar:"/team/diaochan.png"},211:{name:"董卓",type:"群雄",avatar:"/team/dongzhuo.png"},212:{name:"张角",type:"群雄",avatar:"/team/xiaozhangjiao.png"},213:{name:"张辽",type:"魏国",avatar:"/team/zhangliao.png"},214:{name:"夏侯惇",type:"魏国",avatar:"/team/xiahoudun.png"},215:{name:"许褚",type:"魏国",avatar:"/team/xuzhu.png"},216:{name:"夏侯渊",type:"魏国",avatar:"/team/xiahouyuan.png"},217:{name:"魏延",type:"蜀国",avatar:"/team/weiyan.png"},218:{name:"黄忠",type:"蜀国",avatar:"/team/huangzhong.png"},219:{name:"马超",type:"蜀国",avatar:"/team/machao.png"},220:{name:"马岱",type:"蜀国",avatar:"/team/madai.png"},221:{name:"吕蒙",type:"吴国",avatar:"/team/lvmeng.png"},222:{name:"黄盖",type:"吴国",avatar:"/team/huanggai.png"},223:{name:"蔡文姬",type:"魏国",avatar:"/team/caiwenji.png"},224:{name:"小乔",type:"吴国",avatar:"/team/xiaoqiao.png"},225:{name:"袁绍",type:"群雄",avatar:"/team/yuanshao.png"},226:{name:"华雄",type:"群雄",avatar:"/team/huaxiong.png"},227:{name:"颜良",type:"群雄",avatar:"/team/yanliang.png"},228:{name:"文丑",type:"群雄",avatar:"/team/wenchou.png"},301:{name:"周泰",type:"吴国",avatar:"/team/zhoutai.png"},302:{name:"许攸",type:"魏国",avatar:"/team/xuyou.png"},303:{name:"于禁",type:"魏国",avatar:"/team/yujin.png"},304:{name:"张星彩",type:"蜀国",avatar:"/team/zhangxingcai.png"},305:{name:"关银屏",type:"蜀国",avatar:"/team/guanyinping.png"},306:{name:"关平",type:"蜀国",avatar:"/team/guanping.png"},307:{name:"程普",type:"吴国",avatar:"/team/chengpu.png"},308:{name:"张昭",type:"吴国",avatar:"/team/zhangzhao.png"},309:{name:"陆绩",type:"吴国",avatar:"/team/luji.png"},310:{name:"吕玲绮",type:"群雄",avatar:"/team/lvlingqi.png"},311:{name:"潘凤",type:"群雄",avatar:"/team/panfeng.png"},312:{name:"邢道荣",type:"群雄",avatar:"/team/xingdaorong.png"},313:{name:"祝融夫人",type:"群雄",avatar:"/team/zhurongfuren.png"},314:{name:"孟获",type:"群雄",avatar:"/team/menghuo.png"}},$=S(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected"),D=S(()=>{var p;return((p=s.gameData)==null?void 0:p.presetTeam)??null});function M(p){var ie;if(!p)return{useTeamId:1,teams:{}};const b=p.presetTeamInfo??p,x=te=>{if(!te||typeof te!="object")return null;if(typeof te.useTeamId=="number")return te.useTeamId;for(const j of Object.keys(te)){const le=x(te[j]);if(le)return le}return null},N=b.useTeamId??((ie=b.presetTeamInfo)==null?void 0:ie.useTeamId)??x(b)??1,L=b.presetTeamInfo??b,H={},oe=Object.keys(L||{}).filter(te=>/^\d+$/.test(te));for(const te of oe){const j=Number(te),le=L[te];if(!le){H[j]={teamInfo:{}};continue}if(le.teamInfo)H[j]={teamInfo:le.teamInfo};else if(le.heroes){const J={};le.heroes.forEach((E,A)=>{J[String(A+1)]=E}),H[j]={teamInfo:J}}else if(typeof le=="object"){const J=Object.values(le).some(E=>E&&typeof E=="object"&&"heroId"in E);H[j]={teamInfo:J?le:{}}}else H[j]={teamInfo:{}}}return{useTeamId:Number(N)||1,teams:H}}const w=S(()=>M(D.value)),Z=S(()=>{var x;const p=(x=w.value.teams[h.value])==null?void 0:x.teamInfo;if(console.log("🚀 ~ team:",p),!p)return[];const b=[];for(const[N,L]of Object.entries(p)){const H=(L==null?void 0:L.heroId)??(L==null?void 0:L.id);if(!H)continue;const oe=U[Number(H)];b.push({id:Number(H),name:(oe==null?void 0:oe.name)??`英雄${H}`,type:(oe==null?void 0:oe.type)??"",position:Number(N),level:(L==null?void 0:L.level)??1,avatar:oe==null?void 0:oe.avatar})}return b.sort((N,L)=>N.position-L.position),console.log("🚀 ~ heroes:",b),b}),f=async(p,b,x={},N="",L=8e3)=>{try{return await s.sendMessageWithPromise(p,b,x,L)}catch(H){throw N&&a.error(`${N}失败：${(H==null?void 0:H.message)??H}`),H}},y=async(p=!1)=>{var x,N;if(!s.selectedToken)return a.warning("请先选择Token"),null;const b=s.selectedToken.id;if(!p){const L=(N=(x=s.gameData)==null?void 0:x.presetTeam)==null?void 0:N.presetTeamInfo;if(L)return L}n.value=!0;try{const L=await f(b,"presetteam_getinfo",{},"获取阵容信息");return s.$patch(H=>{H.gameData={...H.gameData??{},presetTeam:L}}),(L==null?void 0:L.presetTeamInfo)??null}catch(L){return console.error("获取阵容信息失败:",L),null}finally{n.value=!1}},R=()=>{const p=Object.keys(w.value.teams).map(Number).filter(b=>!Number.isNaN(b)).sort((b,x)=>b-x);T.value=p.length?p:[1,2,3,4]},O=()=>{h.value=w.value.useTeamId||1},I=async p=>{if(l.value||n.value)return;if(!s.selectedToken){a.warning("请先选择Token");return}const b=h.value;l.value=!0;try{await f(s.selectedToken.id,"presetteam_saveteam",{teamId:p},`切换到阵容 ${p}`),h.value=p,a.success(`已切换到阵容 ${p}`),await C(!0)}catch{h.value=b}finally{l.value=!1}},C=async(p=!1)=>{await y(p)};return ke(async()=>{s.selectedToken&&$.value==="connected"&&(await C(!1),R(),O(),D.value||(await C(!0),R(),O()))}),ve($,(p,b)=>{p==="connected"&&b!=="connected"&&s.selectedToken&&setTimeout(async()=>{await C(!1),R(),O(),D.value||(await C(!0),R(),O())},1e3)}),ve(()=>s.selectedToken,async(p,b)=>{p&&p.id!==(b==null?void 0:b.id)&&s.getWebSocketStatus(p.id)==="connected"&&(await C(!0),R(),O())}),ve(()=>D.value,()=>{R(),O()},{deep:!0}),(p,b)=>(m(),k("div",Un,[e("div",Bn,[b[2]||(b[2]=e("img",{src:Ne,alt:"阵容",class:"icon"},null,-1)),b[3]||(b[3]=e("div",{class:"info"},[e("h3",null,"阵容"),e("p",null,"当前使用的战斗阵容")],-1)),e("div",En,[(m(!0),k(pe,null,ye(T.value,x=>(m(),k("button",{key:x,disabled:n.value||l.value,class:me(["team-button",{active:h.value===x}]),onClick:N=>I(x)},_(x),11,Ln))),128)),e("button",{class:"refresh-button",disabled:n.value,title:"刷新队伍数据",onClick:b[0]||(b[0]=x=>C(!0))},[...b[1]||(b[1]=[Ve('<svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d5002a27><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-d5002a27></path><path d="M21 3v5h-5" data-v-d5002a27></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-d5002a27></path><path d="M3 21v-5h5" data-v-d5002a27></path></svg><span class="refresh-text" data-v-d5002a27>刷新</span>',2)])],8,Hn)])]),e("div",On,[e("div",Pn,[b[4]||(b[4]=e("span",{class:"label"},"当前阵容",-1)),e("span",Fn,[n.value?(m(),k(pe,{key:1},[Q("加载中…")],64)):(m(),k(pe,{key:0},[Q("阵容 "+_(h.value),1)],64))])]),e("div",jn,[n.value?ae("",!0):(m(),k("div",qn,[(m(!0),k(pe,null,ye(Z.value,x=>{var N;return m(),k("div",{key:x.id||x.name,class:"hero-item"},[e("div",Gn,[x.avatar?(m(),k("img",{key:0,src:x.avatar,alt:x.name,class:"hero-avatar"},null,8,Vn)):(m(),k("div",Qn,_(((N=x.name)==null?void 0:N.substring(0,2))||"?"),1))]),e("span",Jn,_(x.name||"未知"),1)])}),128))])),!n.value&&!Z.value.length?(m(),k("div",Kn,[...b[5]||(b[5]=[e("p",null,"暂无队伍信息",-1)])])):ae("",!0),n.value?(m(),k("div",Yn,[...b[6]||(b[6]=[e("p",null,"正在加载队伍信息…",-1)])])):ae("",!0)])])]))}}),Zn=he(Xn,[["__scopeId","data-v-d5002a27"]]),eo={key:0,class:"identity-embedded"},to={class:"identity-card embedded"},so={class:"role-profile-content"},ao={class:"avatar-container"},no=["src","alt"],oo={class:"role-info-section"},lo={class:"role-name"},io={class:"role-stats"},ro={class:"level-text"},co={class:"power-value"},uo={class:"rank-section"},mo={class:"rank-icon"},vo={class:"rank-title"},po={key:1,class:"resources"},fo={class:"label"},go={class:"value"},_o={key:2,class:"loading"},ho={class:"identity-card"},yo={class:"card-header"},ko={class:"role-profile-content"},bo={class:"avatar-container"},wo=["src","alt"],$o={class:"role-info-section"},To={class:"role-name"},Co={class:"role-stats"},So={class:"level-text"},Io={class:"power-value"},xo={class:"rank-section"},Mo={class:"rank-icon"},Do={class:"rank-title"},zo={key:1,class:"loading"},Ao=Ce({__name:"IdentityCard",props:{visible:{type:Boolean},embedded:{type:Boolean}},emits:["close"],setup(Y,{emit:s}){const a=ge(),n=s,l=S(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id):"disconnected"),h=S(()=>{var i,t;const E=a.gameData,A=(i=E==null?void 0:E.roleInfo)==null?void 0:i.role;return A?{roleId:A.roleId,name:A.name,headImg:A.headImg,level:A.level,power:A.power||A.fighting||0,gold:A.gold??0,diamond:A.diamond??0,fishing:A.fishing||A.fish||null,items:A.items||A.itemList||((t=A.bag)==null?void 0:t.items)||A.inventory||null}:{}}),T=S(()=>Object.keys(h.value||{}).length>0),U=["/icons/1733492491706148.png","/icons/1733492491706152.png","/icons/1736425783912140.png","/icons/173746572831736.png","/icons/174023274867420.png"],$=V(""),D=V(""),M=[{min:0,max:1e6,title:"初出茅庐",icon:"🌱",class:"rank-beginner"},{min:1e6,max:1e7,title:"小有名气",icon:"⚔️",class:"rank-known"},{min:1e7,max:1e8,title:"出入江湖",icon:"🗡️",class:"rank-veteran"},{min:1e8,max:5e8,title:"纵横四方",icon:"🏹",class:"rank-master"},{min:5e8,max:2e9,title:"盖世豪杰",icon:"⚡",class:"rank-hero"},{min:2e9,max:4e9,title:"一方枭雄",icon:"👑",class:"rank-overlord"},{min:4e9,max:6e9,title:"睥睨江湖",icon:"🔱",class:"rank-supreme"},{min:6e9,max:9e9,title:"独霸天下",icon:"⚜️",class:"rank-emperor"},{min:9e9,max:15e9,title:"不世之尊",icon:"💎",class:"rank-legend"},{min:15e9,max:1/0,title:"无极至尊",icon:"🌟",class:"rank-infinite"}],w=S(()=>{const E=Number(h.value.power||0);return M.find(A=>E>=A.min&&E<A.max)||M[0]}),Z=E=>{if(!E)return"0";const A=1e8,i=1e4;return E>=A?(E/A).toFixed(1)+"亿":E>=i?(E/i).toFixed(1)+"万":E.toLocaleString()},f=E=>{const A=Number(E||0),i=1e8,t=1e4;return A>=i?(A/i).toFixed(1)+"亿":A>=t?(A/t).toFixed(1)+"万":A.toLocaleString()},y=S(()=>h.value.gold??0),R=S(()=>h.value.diamond??0),O=(E,A)=>{if(!E)return null;if(Array.isArray(E)){const t=E.find(c=>Number(c.id??c.itemId)===A);return t?Number(t.num??t.count??t.quantity??0):0}const i=E[String(A)]??E[A];if(console.log("🚀 ~ getItemCount ~ node:",i),i==null){const t=Object.values(E).find(c=>Number((c==null?void 0:c.itemId)??(c==null?void 0:c.id))===A);return t?Number(t.num??t.count??t.quantity??0):0}return typeof i=="number"?Number(i):typeof i=="object"?Number(i.num??i.count??i.quantity??0):Number(i)||0},I=S(()=>(console.log("🚀 ~ items:",I),h.value.items)),C=S(()=>O(I.value,1011)),p=S(()=>O(I.value,1012)),b=S(()=>O(I.value,1013)),x=S(()=>O(I.value,1001)),N=S(()=>O(I.value,1006)),L=S(()=>O(I.value,1023)),H=S(()=>O(I.value,1003)),oe=S(()=>{var A,i,t,c;const E=C.value;return E??((i=(A=h.value)==null?void 0:A.fishing)==null?void 0:i.normalRod)??((c=(t=h.value)==null?void 0:t.fishing)==null?void 0:c.rod)??null}),ie=S(()=>{var A,i,t,c;const E=p.value;return E??((i=(A=h.value)==null?void 0:A.fishing)==null?void 0:i.goldRod)??((c=(t=h.value)==null?void 0:t.fishing)==null?void 0:c.vipRod)??null}),te=E=>E==null?"-":f(Number(E)),j=S(()=>[{label:"金币",value:f(y.value)},{label:"金砖",value:f(R.value)},{label:"普通鱼竿",value:te(oe.value)},{label:"金鱼竿",value:te(ie.value)},{label:"珍珠",value:te(b.value)},{label:"招募令",value:te(x.value)},{label:"精铁",value:te(N.value)},{label:"彩玉",value:te(L.value)},{label:"进阶石",value:te(H.value)}]),le=()=>{if(h.value&&h.value.headImg)$.value=h.value.headImg;else{if(!D.value){const E=h.value.roleId||h.value.name||"default",A=Array.from(String(E)).reduce((i,t)=>i+t.charCodeAt(0),0);D.value=U[A%U.length]}$.value=D.value}},J=()=>{if(!D.value){const E=Math.floor(Math.random()*U.length);D.value=U[E]}$.value=D.value};return ke(async()=>{if(le(),a.selectedToken&&l.value==="connected")try{await a.sendMessage(a.selectedToken.id,"role_getroleinfo")}catch{}}),ve(()=>h.value,le,{deep:!0}),(E,A)=>Y.embedded?(m(),k("div",eo,[e("div",to,[A[2]||(A[2]=e("div",{class:"card-header"},[e("img",{src:Ne,alt:"身份牌",class:"icon"}),e("div",{class:"info"},[e("h3",null,"身份牌"),e("p",null,"角色与资源概览")])],-1)),T.value?(m(),k("div",{key:0,class:me(["role-profile-header",w.value.class])},[e("div",so,[e("div",ao,[e("img",{src:$.value,alt:h.value.name||"角色",class:"role-avatar",onError:J},null,40,no)]),e("div",oo,[e("div",lo,_(h.value.name||"未知角色"),1),e("div",io,[e("span",ro,"Lv."+_(h.value.level||1),1),e("span",co,"战力 "+_(Z(h.value.power)),1)])]),e("div",uo,[e("div",mo,_(w.value.icon),1),e("div",vo,_(w.value.title),1)])])],2)):ae("",!0),T.value?(m(),k("div",po,[(m(!0),k(pe,null,ye(j.value,i=>(m(),k("div",{key:i.label,class:"res-item"},[e("span",fo,_(i.label),1),e("span",go,_(i.value),1)]))),128))])):(m(),k("div",_o,"正在获取角色信息..."))])])):(m(),ue(Je,{key:1,name:"drop"},{default:v(()=>[$e(e("div",{class:"identity-overlay",onClick:A[1]||(A[1]=Qe(i=>n("close"),["self"]))},[e("div",ho,[A[6]||(A[6]=e("div",{class:"strap"},[e("div",{class:"strap-tape"}),e("div",{class:"strap-buckle"})],-1)),e("div",yo,[A[3]||(A[3]=e("img",{src:Ne,alt:"身份牌",class:"icon"},null,-1)),A[4]||(A[4]=e("div",{class:"info"},[e("h3",null,"身份牌"),e("p",null,"角色与战力概览")],-1)),e("button",{class:"close-btn",onClick:A[0]||(A[0]=i=>n("close"))},"✕")]),T.value?(m(),k("div",{key:0,class:me(["role-profile-header",w.value.class])},[e("div",ko,[e("div",bo,[e("img",{src:$.value,alt:h.value.name||"角色",class:"role-avatar",onError:J},null,40,wo)]),e("div",$o,[e("div",To,_(h.value.name||"未知角色"),1),e("div",Co,[e("span",So,"Lv."+_(h.value.level||1),1),e("span",Io,"战力 "+_(Z(h.value.power)),1)])]),e("div",xo,[e("div",Mo,_(w.value.icon),1),e("div",Do,_(w.value.title),1)])]),A[5]||(A[5]=e("div",{class:"glow-border"},null,-1))],2)):(m(),k("div",zo,"正在获取角色信息..."))])],512),[[Te,Y.visible]])]),_:1}))}}),No=he(Ao,[["__scopeId","data-v-3fe2a989"]]),Wo="/xyzw_web_helper/icons/173746572831736.png",Ro={class:"time-display"},Uo={__name:"BottleHelperCard",setup(Y){const s=ge(),a=_e(),n=S(()=>{var D;return((D=s.gameData)==null?void 0:D.roleInfo)||null}),l=V({isRunning:!1,remainingTime:0,stopTime:0}),h=D=>{const M=Math.floor(Number(D)||0);if(M<=0)return"00:00:00";const w=Math.floor(M/3600).toString().padStart(2,"0"),Z=Math.floor(M%3600/60).toString().padStart(2,"0"),f=(M%60).toString().padStart(2,"0");return`${w}:${Z}:${f}`},T=()=>{var w;const D=(w=n.value)==null?void 0:w.role;if(!(D!=null&&D.bottleHelpers))return;const M=Date.now()/1e3;l.value.stopTime=D.bottleHelpers.helperStopTime,l.value.isRunning=D.bottleHelpers.helperStopTime>M,l.value.remainingTime=Math.max(0,Math.floor(D.bottleHelpers.helperStopTime-M))};ve(n,()=>T(),{deep:!0,immediate:!0});let U=null;ke(()=>{U=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1))},1e3)}),xe(()=>{U&&clearInterval(U)});const $=()=>{if(!s.selectedToken){a.warning("请先选择Token");return}const D=s.selectedToken.id;s.sendMessage(D,"bottlehelper_stop"),setTimeout(()=>{s.sendMessage(D,"bottlehelper_start"),s.sendMessage(D,"role_getroleinfo")},500),a.info(l.value.isRunning?"重启盐罐机器人":"启动盐罐机器人")};return(D,M)=>{const w=Pe;return m(),ue(Me,{class:"bottle-helper",statusClass:{active:l.value.isRunning}},{icon:v(()=>[...M[0]||(M[0]=[e("img",{src:Wo,alt:"盐罐图标"},null,-1)])]),title:v(()=>[...M[1]||(M[1]=[e("h3",null,"盐罐机器人",-1),e("p",null,"剩余时间",-1)])]),badge:v(()=>[e("span",null,_(l.value.isRunning?"运行中":"已停止"),1)]),default:v(()=>[e("div",Ro,_(h(l.value.remainingTime)),1)]),action:v(()=>[d(w,{type:"primary",secondary:"",size:"small",block:"",onClick:$},{default:v(()=>[Q(_(l.value.isRunning?"重启服务":"启动服务"),1)]),_:1})]),_:1},8,["statusClass"])}}},Bo=he(Uo,[["__scopeId","data-v-e178c49e"]]),Eo="/xyzw_web_helper/icons/174061875626614.png",Lo={class:"time-display"},Ho=["disabled"],Oo={key:0,class:"loading-text"},Po={key:1},Fo=["disabled"],jo={key:0,class:"loading-text"},qo={key:1},Go={__name:"HangUpStatusCard",setup(Y){const s=ge(),a=_e(),n=S(()=>{var M;return((M=s.gameData)==null?void 0:M.roleInfo)||null}),l=V({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),h=M=>{const w=Math.floor(Number(M)||0);if(w<=0)return"00:00:00";const Z=Math.floor(w/3600).toString().padStart(2,"0"),f=Math.floor(w%3600/60).toString().padStart(2,"0"),y=(w%60).toString().padStart(2,"0");return`${Z}:${f}:${y}`},T=()=>{var f;const M=(f=n.value)==null?void 0:f.role;if(!(M!=null&&M.hangUp))return;const w=Date.now()/1e3;l.value.lastTime=M.hangUp.lastTime,l.value.hangUpTime=M.hangUp.hangUpTime;const Z=w-l.value.lastTime;Z<=l.value.hangUpTime?(l.value.remainingTime=Math.floor(l.value.hangUpTime-Z),l.value.isActive=!0):(l.value.remainingTime=0,l.value.isActive=!1),l.value.elapsedTime=Math.floor(l.value.hangUpTime-l.value.remainingTime)};ve(n,()=>T(),{deep:!0,immediate:!0});let U=null;ke(()=>{U=setInterval(()=>{l.value.isActive&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.elapsedTime=l.value.elapsedTime+1,l.value.remainingTime<=0&&(l.value.isActive=!1))},1e3)}),xe(()=>{U&&clearInterval(U)});const $=async()=>{if(!s.selectedToken)return a.warning("请先选择Token");const M=s.selectedToken.id;try{l.value.isExtending=!0,a.info("正在加钟...");const w=[];for(let Z=0;Z<4;Z++)w.push(new Promise(f=>{setTimeout(()=>{s.sendMessage(M,"system_mysharecallback",{isSkipShareCard:!0,type:2}),f()},Z*300)}));await Promise.all(w),setTimeout(()=>s.sendMessage(M,"role_getroleinfo"),1500),setTimeout(()=>{a.success("加钟操作已完成，请查看挂机剩余时间"),l.value.isExtending=!1},2500)}catch(w){a.error("加钟操作失败: "+((w==null?void 0:w.message)||"未知错误")),l.value.isExtending=!1}},D=async()=>{if(!s.selectedToken)return a.warning("请先选择Token");const M=s.selectedToken.id;try{l.value.isClaiming=!0,a.info("正在领取挂机奖励..."),s.sendMessage(M,"system_mysharecallback"),setTimeout(()=>s.sendMessage(M,"system_claimhangupreward"),200),setTimeout(()=>s.sendMessage(M,"system_mysharecallback",{isSkipShareCard:!0,type:2}),400),setTimeout(()=>s.sendMessage(M,"role_getroleinfo"),600),setTimeout(()=>{a.success("挂机奖励领取完成"),l.value.isClaiming=!1},1200)}catch(w){a.error("领取挂机奖励失败: "+((w==null?void 0:w.message)||"未知错误")),l.value.isClaiming=!1}};return(M,w)=>(m(),ue(Me,{class:"hang-up",statusClass:{active:l.value.isActive}},{icon:v(()=>[...w[0]||(w[0]=[e("img",{src:Eo,alt:"挂机图标"},null,-1)])]),title:v(()=>[w[1]||(w[1]=e("h3",null,"挂机时间",-1)),e("p",null,"已挂机："+_(h(l.value.elapsedTime)),1)]),badge:v(()=>[e("span",null,_(l.value.isActive?"挂机中":"已完成"),1)]),default:v(()=>[e("div",Lo,_(h(l.value.remainingTime)),1)]),action:v(()=>[e("button",{class:"action-button secondary",disabled:l.value.isExtending,onClick:$},[l.value.isExtending?(m(),k("span",Oo,[...w[2]||(w[2]=[e("i",{class:"line-md:loading-loop"},null,-1),Q(" 加钟中... ",-1)])])):(m(),k("span",Po,"加钟"))],8,Ho),e("button",{class:"action-button primary",disabled:l.value.isClaiming,onClick:D},[l.value.isClaiming?(m(),k("span",jo,[...w[3]||(w[3]=[e("i",{class:"line-md:loading-loop"},null,-1),Q(" 领取中... ",-1)])])):(m(),k("span",qo,"领取奖励"))],8,Fo)]),_:1},8,["statusClass"]))}},Vo=he(Go,[["__scopeId","data-v-491764b8"]]),Fe="/xyzw_web_helper/icons/1736425783912140.png",Qo={key:0},Jo={key:1},Ko={class:"monthly-row"},Yo={class:"row-value"},Xo={class:"monthly-row"},Zo={class:"row-value"},el={class:"action-row"},tl=["disabled"],be=320,we=240,sl={__name:"MonthlyTasksCard",setup(Y,{expose:s}){const a=ge(),n=_e(),l=V(!1),h=V(!1),T=V(!1),U=V(null),$=new Date,D=new Date($.getFullYear(),$.getMonth()+1,0).getDate(),M=$.getDate(),w=S(()=>Math.max(0,D-M)),Z=S(()=>Math.min(1,Math.max(0,M/D))),f=S(()=>{var c;return((c=U.value)==null?void 0:c.myMonthInfo)||{}}),y=S(()=>{var c;return((c=U.value)==null?void 0:c.myArenaInfo)||{}}),R=S(()=>{var c,u;return Number(((u=(c=f.value)==null?void 0:c["2"])==null?void 0:u.num)||0)}),O=S(()=>{var c;return Number(((c=y.value)==null?void 0:c.num)||0)}),I=S(()=>Math.min(100,Math.round(R.value/be*100))),C=S(()=>Math.min(100,Math.round(O.value/we*100))),p=S(()=>w.value===0?be:Math.min(be,Math.ceil(Z.value*be))),b=S(()=>w.value===0?we:Math.min(we,Math.ceil(Z.value*we))),x=[{label:"一键完成",key:"complete-fish"}],N=[{label:"一键完成",key:"complete-arena"}],L=S(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id)==="connected":!1),H=async()=>{var c;if(!a.selectedToken)return n.warning("请先选择Token");if(L.value){l.value=!0;try{const u=a.selectedToken.id,P=await a.sendMessageWithPromise(u,"activity_get",{},1e4),K=(P==null?void 0:P.activity)||((c=P==null?void 0:P.body)==null?void 0:c.activity)||P;U.value=K||null,K&&n.success("月度任务进度已更新")}catch(u){n.error(`获取月度任务失败：${u.message}`)}finally{l.value=!1}}},oe=()=>{const c=new Date;return c.setHours(0,0,0,0),Math.floor(c.getTime()/1e3)},ie=c=>!c||typeof c!="number"?!0:c<oe(),te=c=>{const u=c==="fish",P=u?be:we,K=u?R.value:O.value,G=u?p.value:b.value,ee=Math.max(0,G-K);return ee<=0?n.success("当前进度已达标，无需补齐"):u?E(ee,G,P):i(ee,G,P)},j=c=>{const u=c==="fish",P=u?be:we,K=u?R.value:O.value,G=Math.max(0,P-K);return G<=0?n.success("已满额，无需完成"):u?E(G,P,P):i(G,P,P)},le=c=>{c==="complete-fish"&&j("fish")},J=c=>{c==="complete-arena"&&j("arena")},E=async(c,u,P)=>{var K,G,ee,z,X;if(!a.selectedToken)return n.warning("请先选择Token");if(!L.value)return n.warning("请先建立WS连接");h.value=!0;try{const de=a.selectedToken.id;let fe=(G=(K=a.gameData)==null?void 0:K.roleInfo)==null?void 0:G.role;if(!fe){try{await a.sendGetRoleInfo(de)}catch{}fe=(z=(ee=a.gameData)==null?void 0:ee.roleInfo)==null?void 0:z.role}let r=0;const g=Number(((X=fe==null?void 0:fe.statisticsTime)==null?void 0:X["artifact:normal:lottery:time"])||0);if(ie(g)){n.info("检测到今日免费钓鱼次数，开始消耗 3 次");for(let W=0;W<3;W++)try{await a.sendMessageWithPromise(de,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},8e3),r++,await new Promise(F=>setTimeout(F,500))}catch{break}r>0&&await H()}let o=Math.max(0,u-R.value);if(o<=0)return n.success("已通过免费次数完成当日目标");for(n.info(`开始付费钓鱼补齐：共需 ${o} 次（每次最多10）`);o>0;){const W=Math.min(10,o);try{await a.sendMessageWithPromise(de,"artifact_lottery",{lotteryNumber:W,newFree:!0,type:1},12e3)}catch(F){n.error(`钓鱼失败：${F.message}`);break}o-=W,await new Promise(F=>setTimeout(F,800))}await H(),R.value>=u||R.value>=P?n.success("钓鱼补齐完成"):n.warning("钓鱼补齐已停止，未达到目标")}finally{h.value=!1}},A=c=>{var P,K,G,ee,z;const u=((P=c==null?void 0:c.rankList)==null?void 0:P[0])||((K=c==null?void 0:c.roleList)==null?void 0:K[0])||((G=c==null?void 0:c.targets)==null?void 0:G[0])||((ee=c==null?void 0:c.targetList)==null?void 0:ee[0])||((z=c==null?void 0:c.list)==null?void 0:z[0]);return u!=null&&u.roleId?u.roleId:u!=null&&u.id?u.id:(c==null?void 0:c.roleId)||(c==null?void 0:c.id)},i=async(c,u,P)=>{if(!a.selectedToken)return n.warning("请先选择Token");if(!L.value)return n.warning("请先建立WS连接");T.value=!0;try{const K=a.selectedToken.id;try{await a.sendMessageWithPromise(K,"arena_startarea",{},6e3)}catch{}let G=0;const ee=100;let z=1,X=c;for(;X>0&&G<ee;){const de=Math.ceil(X/2);n.info(`竞技场补齐 第${z}轮：计划战斗 ${de} 场（估算每胜+2）`);for(let fe=0;fe<de&&G<ee;fe++){let r;try{r=await a.sendMessageWithPromise(K,"arena_getareatarget",{},8e3)}catch(o){n.error(`获取竞技场目标失败：${o.message}`);break}console.info("[Arena] 获取竞技场目标响应",r);const g=A(r);if(!g){n.warning("未找到可用的竞技场目标，已停止此轮");break}try{await a.sendMessageWithPromise(K,"fight_startareaarena",{targetId:g},15e3)}catch(o){n.error(`竞技场对决失败：${o.message}`)}G++,await new Promise(o=>setTimeout(o,1200))}await H(),X=Math.max(0,u-O.value),z++}O.value>=u||O.value>=P?n.success("竞技场补齐完成"):G>=ee?n.warning("达到安全上限，已停止竞技场补齐"):n.warning("竞技场补齐已停止，未达到目标")}finally{T.value=!1}},t=V(!1);return ve(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id):"disconnected",c=>{c==="connected"&&!t.value&&(t.value=!0,H())},{immediate:!0}),ke(()=>{a.selectedToken&&L.value&&H()}),s({fetchMonthlyActivity:H}),(c,u)=>{const P=se("n-button"),K=se("n-dropdown"),G=se("n-button-group");return m(),ue(Me,{class:"monthly-tasks",statusClass:U.value?"active":""},{icon:v(()=>[...u[2]||(u[2]=[e("img",{src:Fe,alt:"月度任务"},null,-1)])]),title:v(()=>[...u[3]||(u[3]=[e("h3",null,"月度任务",-1),e("p",null,"进度与一键补齐",-1)])]),badge:v(()=>[w.value>0?(m(),k("span",Qo,"剩余 "+_(w.value)+" 天",1)):(m(),k("span",Jo,"本月最后一天"))]),default:v(()=>[e("div",Ko,[u[4]||(u[4]=e("div",{class:"row-title"},"钓鱼进度",-1)),e("div",Yo,_(R.value)+" / "+_(be)+"（"+_(I.value)+"%）",1)]),e("div",Xo,[u[5]||(u[5]=e("div",{class:"row-title"},"竞技场进度",-1)),e("div",Zo,_(O.value)+" / "+_(we)+"（"+_(C.value)+"%）",1)]),e("div",el,[e("button",{class:"action-button secondary",disabled:l.value||h.value||T.value,onClick:H},_(l.value?"刷新中...":"刷新进度"),9,tl),d(G,null,{default:v(()=>[d(P,{class:"action-button",disabled:l.value||h.value,onClick:u[0]||(u[0]=ee=>te("fish"))},{default:v(()=>[Q(_(h.value?"补齐中...":"钓鱼补齐"),1)]),_:1},8,["disabled"]),d(K,{options:x,trigger:"click",onSelect:le},{default:v(()=>[d(P,{disabled:l.value||h.value},{default:v(()=>[...u[6]||(u[6]=[Q("▾",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),d(G,null,{default:v(()=>[d(P,{class:"action-button",disabled:l.value||T.value,onClick:u[1]||(u[1]=ee=>te("arena"))},{default:v(()=>[Q(_(T.value?"补齐中...":"竞技场补齐"),1)]),_:1},8,["disabled"]),d(K,{options:N,trigger:"click",onSelect:J},{default:v(()=>[d(P,{disabled:l.value||T.value},{default:v(()=>[...u[7]||(u[7]=[Q("▾",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),e("p",{class:"description muted"}," 补齐规则：让“当前天数比例”和“完成比例”一致；若无剩余天数则按满额（"+_(be)+"/"+_(we)+"）计算。 ")]),_:1},8,["statusClass"])}}},al=he(sl,[["__scopeId","data-v-3cfa5f7d"]]),nl={__name:"StudyChallengeCard",setup(Y){const s=ge(),a=_e(),n=S(()=>s.gameData.studyStatus),l=async()=>{if(!s.selectedToken||n.value.thisWeek||n.value.status!=""&&n.value.status!="idel")return;console.log("开始答题",n.value),n.value.status="starting",await Ke(),n.value.status="answering";const h=await Ye();if(a.info(`🚀 开始一键答题... (题库包含 ${h} 道题目)`),n.value.isCompleted)return a.success("✅ 咸鱼大冲关任务已完成，无需重复作答！");try{s.gameData.studyStatus={...s.gameData.studyStatus,isAnswering:!0,questionCount:0,answeredCount:0,status:"starting",timestamp:Date.now()};const T=s.selectedToken.id;s.sendMessage(T,"study_startgame"),setTimeout(()=>{s.gameData.studyStatus.isAnswering&&(s.gameData.studyStatus={...s.gameData.studyStatus,isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},a.warning("答题超时，已自动重置状态"))},4e4),a.info(`🚀 开始一键答题... (题库包含 ${h} 道题目)`)}catch(T){console.error("启动答题失败:",T),a.error("启动答题失败: "+T.message)}};return(h,T)=>{const U=Pe;return m(),ue(Me,{class:"study",statusClass:{weekly:!0,completed:n.value.isCompleted}},{icon:v(()=>[...T[0]||(T[0]=[e("img",{src:Fe,alt:"学习图标"},null,-1)])]),title:v(()=>[...T[1]||(T[1]=[e("h3",null,"咸鱼大冲关",-1),e("p",null,"每日知识挑战",-1)])]),badge:v(()=>[...T[2]||(T[2]=[e("span",null,"每周任务",-1)])]),default:v(()=>[...T[3]||(T[3]=[e("p",{class:"description"},"没有什么可以阻挡我求知的欲望！",-1)])]),action:v(()=>[n.value.thisWeek?ae("",!0):(m(),ue(U,{key:0,status:"primary",onClick:l},{default:v(()=>[...T[4]||(T[4]=[Q(" 🎯 一键答题. ",-1)])]),_:1})),!n.value.thisWeek&&n.value.status=="starting"?(m(),ue(U,{key:1,status:"warning",disabled:!0},{default:v(()=>[...T[5]||(T[5]=[Q(" 正在获取题库... ",-1)])]),_:1})):ae("",!0),!n.value.thisWeek&&n.value.status=="answering"?(m(),ue(U,{key:2,status:"warning",disabled:!0},{default:v(()=>[...T[6]||(T[6]=[Q(" 答题中... ",-1)])]),_:1})):ae("",!0),!n.value.thisWeek&&n.value.status=="claiming_rewards"?(m(),ue(U,{key:3,status:"warning",disabled:!0},{default:v(()=>[...T[7]||(T[7]=[Q(" 正在领取奖励... ",-1)])]),_:1})):ae("",!0),!n.value.thisWeek&&n.value.status=="completed"?(m(),ue(U,{key:4,status:"warning",disabled:!0},{default:v(()=>[...T[8]||(T[8]=[Q(" 答题完成 ",-1)])]),_:1})):ae("",!0),n.value.thisWeek?(m(),ue(U,{key:5,status:"success",disabled:!0},{default:v(()=>[...T[9]||(T[9]=[Q(" ✅ 已完成无需作答 ",-1)])]),_:1})):ae("",!0)]),_:1},8,["statusClass"])}}},ol={class:"game-status-container"},ll={__name:"GameStatus",setup(Y){const s=ge();_e();const a=V({isRegistered:!1});V(!1);const n=V("daily");S(()=>{const f=new Date().getDay();return f>=1&&f<=3});const l=V({isRunning:!1,remainingTime:0,stopTime:0}),h=V({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),T=V({isSignedIn:!1,clubName:""});S(()=>s.gameData.studyStatus);const U=S(()=>{var f;return((f=s.gameData)==null?void 0:f.roleInfo)||null}),$=S(()=>{var O,I;const f=(I=(O=U.value)==null?void 0:O.role)==null?void 0:I.tower,y=f==null?void 0:f.id;return!(Math.floor(y/10)+1>450)});S(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id)==="connected":!1);const D=()=>{if(!U.value)return;const f=U.value.role;if(f.bottleHelpers){const y=Date.now()/1e3;l.value.stopTime=f.bottleHelpers.helperStopTime,l.value.isRunning=f.bottleHelpers.helperStopTime>y,l.value.remainingTime=Math.max(0,Math.floor(f.bottleHelpers.helperStopTime-y))}if(f.hangUp){const y=Date.now()/1e3;h.value.lastTime=f.hangUp.lastTime,h.value.hangUpTime=f.hangUp.hangUpTime;const R=y-h.value.lastTime;R<=h.value.hangUpTime?(h.value.remainingTime=Math.floor(h.value.hangUpTime-R),h.value.isActive=!0):(h.value.remainingTime=0,h.value.isActive=!1),h.value.elapsedTime=Math.floor(h.value.hangUpTime-h.value.remainingTime)}if(f.statistics){const y=new Date;y.setHours(0,0,0,0);const R=y.getTime()/1e3;a.value.isRegistered=Number(f.statistics["last:legion:match:sign:up:time"])>R}if(f.statisticsTime){const y=new Date;y.setHours(0,0,0,0);const R=y.getTime()/1e3;T.value.isSignedIn=f.statisticsTime["legion:sign:in"]>R}};let M=null;const w=()=>{M&&clearInterval(M),M=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1)),h.value.isActive&&h.value.remainingTime>0&&(h.value.remainingTime=Math.max(0,h.value.remainingTime-1),h.value.elapsedTime=h.value.elapsedTime+1,h.value.remainingTime<=0&&(h.value.isActive=!1))},1e3)};ve(U,f=>{f&&D()},{deep:!0,immediate:!0});const Z=V(!1);return ve(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected",f=>{if(f==="connected"&&!Z.value&&s.selectedToken){Z.value=!0;const y=s.selectedToken.id;s.sendMessage(y,"legion_getinfo")}}),ke(()=>{if(D(),w(),s.selectedToken&&s.getWebSocketStatus(s.selectedToken.id)==="connected"){const f=s.selectedToken.id;s.sendMessage(f,"legion_getinfo"),Z.value=!0}}),xe(()=>{M&&clearInterval(M)}),(f,y)=>{const R=No,O=se("n-tab-pane"),I=se("n-tabs"),C=Zn,p=Rn,b=en,x=Pa,N=Jt;return m(),k("div",ol,[d(R,{embedded:""}),d(I,{class:"section-tabs",value:n.value,"onUpdate:value":y[0]||(y[0]=L=>n.value=L),type:"line",animated:"",size:"small"},{default:v(()=>[d(O,{name:"daily",tab:"日常"}),d(O,{name:"club",tab:"俱乐部"}),d(O,{name:"activity",tab:"活动"})]),_:1},8,["value"]),$e(d(C,null,null,512),[[Te,n.value==="daily"]]),$e(d(p,null,null,512),[[Te,n.value==="daily"]]),$e(d(b,null,null,512),[[Te,n.value==="daily"&&$.value]]),$e(d(Bo,null,null,512),[[Te,n.value==="daily"]]),$e(d(Vo,null,null,512),[[Te,n.value==="daily"]]),ae("",!0),ae("",!0),n.value==="club"?(m(),ue(x,{key:2})):ae("",!0),n.value==="club"?(m(),ue(N,{key:3})):ae("",!0),$e(d(al,null,null,512),[[Te,n.value==="activity"]]),$e(d(nl,null,null,512),[[Te,n.value==="activity"]])])}}},il=he(ll,[["__scopeId","data-v-c2b8890e"]]),rl={class:"game-features-page"},cl={class:"page-header"},ul={class:"container"},dl={class:"header-content"},ml={class:"header-left"},vl={class:"page-subtitle"},pl={class:"header-actions"},fl={key:0,class:"feedback-section"},gl={class:"features-grid-section"},_l={class:"container"},hl={class:"ws-status-section"},yl={class:"container"},kl={class:"ws-status-card"},bl={class:"status-header"},wl={class:"status-content"},$l={class:"status-item"},Tl={key:0,class:"status-item"},Cl={key:1,class:"status-item"},Sl={__name:"GameFeatures",setup(Y){const s=Xe(),a=_e(),n=ge(),l=V(!0),h=V(null),T=S(()=>n.selectedToken&&n.getWebSocketStatus(n.selectedToken.id)==="connected"?"connected":"disconnected"),U=S(()=>n.selectedToken?n.getWebSocketStatus(n.selectedToken.id)==="connected"?"已连接":"未连接":"未选择Token"),$=S(()=>T.value==="connected"?"status-connected":"status-disconnected"),D=S(()=>T.value==="connected"),M=()=>{if(!n.selectedToken){a.warning("请先选择一个Token"),s.push("/tokens");return}try{const y=n.selectedToken.id,R=n.selectedToken.token;n.createWebSocketConnection(y,R),a.info("正在建立 WebSocket 连接..."),setTimeout(async()=>{n.getWebSocketStatus(y)==="connected"&&(a.success("WebSocket 连接成功"),await f())},2e3)}catch(y){console.error("WebSocket连接失败:",y),a.error("WebSocket连接失败")}},w=()=>{if(n.selectedToken){const y=n.selectedToken.id;n.closeWebSocketConnection(y),a.info("WebSocket连接已断开")}},Z=()=>{T.value==="connected"?w():M()};ke(()=>{n.selectedToken&&(n.getWebSocketStatus(n.selectedToken.id)!=="connected"?M():f())}),ve(()=>{if(!n.selectedToken)return{status:"disconnected",lastError:null};const y=n.wsConnections[n.selectedToken.id];return{status:y==null?void 0:y.status,lastError:y==null?void 0:y.lastError}},y=>{if(y&&y.status==="error"&&y.lastError){const R=String(y.lastError.error||"").toLowerCase();R.includes("token")&&R.includes("expired")&&(a.error("当前 Token 已过期，请重新导入后再试"),s.push("/tokens"))}},{deep:!0});const f=async()=>{if(n.selectedToken)try{const y=n.selectedToken.id;n.sendMessage(y,"role_getroleinfo"),n.sendMessage(y,"tower_getinfo"),n.sendMessage(y,"presetteam_getinfo")}catch{}};return xe(()=>{}),(y,R)=>{var p;const O=se("n-icon"),I=il,C=se("n-button");return m(),k("div",rl,[e("div",cl,[e("div",ul,[e("div",dl,[e("div",ml,[R[0]||(R[0]=e("h1",{class:"page-title"}," 游戏功能 ",-1)),e("p",vl,_(((p=ne(n).selectedToken)==null?void 0:p.name)||"未选择Token"),1)]),e("div",pl,[e("div",{class:me(["connection-status",T.value])},[d(O,null,{default:v(()=>[d(ne(vt))]),_:1}),e("span",null,_(U.value),1)],2)])])])]),l.value?(m(),k("div",fl)):ae("",!0),e("div",gl,[e("div",_l,[d(I)])]),e("div",hl,[e("div",yl,[e("div",kl,[e("div",bl,[R[1]||(R[1]=e("h3",null,"连接状态",-1)),d(C,{text:"",onClick:Z},{default:v(()=>[Q(_(D.value?"断开连接":"重新连接"),1)]),_:1})]),e("div",wl,[e("div",$l,[R[2]||(R[2]=e("span",null,"WebSocket状态:",-1)),e("span",{class:me($.value)},_(U.value),3)]),ne(n).selectedToken?(m(),k("div",Tl,[R[3]||(R[3]=e("span",null,"当前Token:",-1)),e("span",null,_(ne(n).selectedToken.name),1)])):ae("",!0),h.value?(m(),k("div",Cl,[R[4]||(R[4]=e("span",null,"最后活动:",-1)),e("span",null,_(h.value),1)])):ae("",!0)])])])])])}}},Ul=he(Sl,[["__scopeId","data-v-00c9c6b2"]]);export{Ul as default};
